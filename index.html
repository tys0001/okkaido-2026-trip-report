<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 åŒ—æµ·é“å†¬å­£æ—…è¡Œå ±å‘Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chosen Palette: Warm Neutrals & Subtle Blue -->
    <!-- Application Structure Plan: æ¡ç”¨é ‚éƒ¨ "åˆ†é æ¨™ç±¤ (Tabs)" çµæ§‹ã€‚ä½¿ç”¨è€…å¯ä»¥é»æ“Š "ç¸½è¦½", "æ¯æ—¥è¡Œç¨‹", "å®‰å…¨", "è£å‚™", "å½ˆæ€§å»ºè­°" ä¹‹é–“åˆ‡æ›ã€‚é€™ç¨®çµæ§‹æœ€ç¬¦åˆä½¿ç”¨è€…å¿ƒæ™ºæ¨¡å‹ï¼Œèƒ½å¿«é€Ÿåœ¨å ±å‘Šçš„ä¸åŒç« ç¯€é–“è·³è½‰ã€‚ä¸»è¦äº’å‹•æ˜¯é»æ“Šåˆ†é åˆ‡æ›å…§å®¹å€å¡Š (show/hide)ï¼Œä»¥åŠåœ¨è¡Œç¨‹ä¸­é»æ“Šåœ°åœ–é€£çµå’Œ AI æ¨è–¦æŒ‰éˆ•ã€‚é¸æ“‡æ­¤çµæ§‹æ˜¯å› å…¶æ¸…æ™°ã€ç°¡å–®ï¼Œç¬¦åˆå ±å‘Šçš„ç·šæ€§é–±è®€é‚Bè¼¯ï¼ŒåŒæ™‚å…è¨±éç·šæ€§æ¢ç´¢ã€‚ -->
    <!-- Visualization & Content Choices: 
        - [å ±å‘Šæ¦‚è¦] -> Goal: å‚³é”æ ¸å¿ƒè³‡è¨Š -> Viz: æ–‡å­— + é—œéµæ•¸æ“šå¡ç‰‡ -> Interaction: ç„¡ -> Justification: å¿«é€Ÿå‚³é”æ—…è¡ŒåŸºç¤è³‡è¨Šã€‚
        - [æ—…è¡Œæˆå“¡] -> Goal: é¡¯ç¤ºæˆå“¡çµ„æˆ -> Viz: DOUGHNUT Chart (å·²ç§»é™¤) -> Interaction: ç„¡ -> Justification: (å·²ç§»é™¤)ã€‚
        - [è¡Œç¨‹é€Ÿè¦½] -> Goal: å¿«é€Ÿæ¦‚è¦½å…­å¤© -> Viz: ç°¡æ˜“è¡¨æ ¼ (HTML) -> Interaction: ç„¡ -> Justification: è¡¨æ ¼æ¯”æ–‡å­—åˆ—è¡¨æ›´æ¸…æ™°ã€‚
        - [æ¯æ—¥è¡Œç¨‹] -> Goal: è©³ç´°èªªæ˜ -> Viz: å¡ç‰‡å¼ä½ˆå±€ + åœ–ç‰‡ + åˆ—è¡¨ -> Interaction: é»æ“Šåœ°åœ–é€£çµ (æ–°åˆ†é ), é»æ“Š AI æ¨è–¦ (API call) -> Justification: å¡ç‰‡+åœ–ç‰‡ä½ˆå±€æ›´ç”Ÿå‹•ï¼Œåœ°åœ–é€£çµå¢åŠ å¯¦ç”¨æ€§ã€‚
        - [é›ªåœ°å®‰å…¨] -> Goal: å¼·èª¿é¢¨éšª -> Viz: åˆ—è¡¨ + é‡é»é«˜äº® -> Interaction: ç„¡ -> Justification: å¿…é ˆæ¸…æ™°æ˜“è®€ã€‚
        - [è£å‚™æ¸…å–®] -> Goal: æª¢æŸ¥è¡¨ -> Viz: åˆ†é¡åˆ—è¡¨ (HTML) -> Interaction: ç„¡ -> Justification: çµæ§‹åŒ–æ¸…å–®æ˜“æ–¼æ ¸å°ã€‚
        - [å½ˆæ€§å»ºè­°] -> Goal: æä¾›é¡å¤–é¸é … -> Viz: æ¢åˆ—å¼æ–‡å­— -> Interaction: ç„¡ -> Justification: è£œå……è³‡è¨Šã€‚
        - [AI åŠ©ç†] -> Goal: å³æ™‚å”åŠ© -> Viz: èŠå¤©ä»‹é¢ (å·²ç§»é™¤) -> Interaction: (å·²ç§»é™¤)ã€‚
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            color: #4b5563;
            background-color: #f3f4f6;
        }

        .nav-tab:hover {
            background-color: #e5e7eb;
        }

        .nav-tab.active {
            background-color: #ffffff;
            color: #1d4ed8;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1), 0 4px 6px -4px rgba(59, 130, 246, 0.1);
        }

        @media (min-width: 640px) {
            .nav-tab {
                font-size: 1rem;
            }
        }

        .preview-toggle-button {
            align-self: flex-start;
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            background: linear-gradient(135deg, #1d4ed8, #2563eb);
            color: #ffffff;
            box-shadow: 0 8px 16px -6px rgba(37, 99, 235, 0.4);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: none;
            cursor: pointer;
            white-space: nowrap;
        }

        .preview-toggle-button:hover,
        .preview-toggle-button:focus {
            transform: translateY(-1px);
            box-shadow: 0 12px 20px -6px rgba(37, 99, 235, 0.45);
            outline: none;
        }

        .preview-toggle-button:focus-visible {
            outline: 2px solid rgba(37, 99, 235, 0.6);
            outline-offset: 2px;
        }

        .content-section {
            display: none;
            padding: 1rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(15, 23, 42, 0.1), 0 4px 6px -4px rgba(15, 23, 42, 0.1);
        }

        @media (min-width: 640px) {
            .content-section {
                padding: 1.5rem;
            }
        }

        .content-section.active {
            display: block;
        }

        #preview-banner {
            display: none;
        }

        body.preview-mode #preview-banner {
            display: block;
        }

        body.preview-mode .content-section {
            display: block;
            margin-bottom: 1.5rem;
        }

        body.preview-mode .content-section:last-of-type {
            margin-bottom: 0;
        }

        .map-link {
            color: #2563eb;
            transition: color 0.2s ease-in-out;
        }

        .map-link:hover {
            color: #1e40af;
            text-decoration: underline;
        }

        .map-icon {
            margin-left: 0.25rem;
            color: #ef4444;
            display: inline-block;
        }

        .ai-recommend-btn {
            margin-left: 0.5rem;
            padding: 0.25rem 0.75rem;
            background-color: #f3e8ff;
            color: #7c3aed;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
            border: none;
        }

        .ai-recommend-btn:hover {
            background-color: #e9d5ff;
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
            cursor: wait;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .ai-recommendation {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background-color: #faf5ff;
            border: 1px solid #ddd6fe;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #374151;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 md:p-8">

    <div class="max-w-6xl mx-auto">
        
        <!-- æ¨™é¡Œ -->
        <header class="mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">2026 åŒ—æµ·é“å†¬å­£æ—…è¡Œå ±å‘Š</h1>
            <p class="text-lg sm:text-xl text-gray-600 mt-1">æœ­å¹Œé›ªç¥­ã€æº«æ³‰åŠé“å—åœ°å€å…­æ—¥è¡Œç¨‹è¦åŠƒ</p>
        </header>

        <!-- å°è¦½åˆ—èˆ‡é è¦½åˆ‡æ› -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
            <nav id="nav-tabs" class="flex flex-wrap gap-2">
                <button class="nav-tab active" data-tab="overview">ç¸½è¦½</button>
                <button class="nav-tab" data-tab="itinerary">æ¯æ—¥è¡Œç¨‹</button>
                <button class="nav-tab" data-tab="safety">é›ªåœ°å®‰å…¨</button>
                <button class="nav-tab" data-tab="gear">è£å‚™æ¸…å–®</button>
                <button class="nav-tab" data-tab="options">å½ˆæ€§å»ºè­°</button>
            </nav>
            <button id="preview-toggle" type="button" class="preview-toggle-button" aria-pressed="false">é è¦½æ¨¡å¼</button>
        </div>

        <!-- å…§å®¹å€å¡Š -->
        <main>
            <div id="preview-banner" hidden class="mb-4 rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 text-sm text-blue-800">
                å·²å•Ÿç”¨é è¦½æ¨¡å¼ï¼šæ‰€æœ‰ç« ç¯€å°‡ä¸€æ¬¡é¡¯ç¤ºï¼Œæ–¹ä¾¿åˆ—å°æˆ–æ•´é«”ç€è¦½ã€‚
            </div>
            <!-- 1. ç¸½è¦½ (Overview) -->
            <section id="content-overview" class="content-section active">
                <div class="space-y-6">
                    <!-- ç°¡æ˜“è¡Œç¨‹è¡¨ Card -->
                    <div class="bg-white p-5 rounded-lg shadow-sm border">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">ç°¡æ˜“è¡Œç¨‹è¡¨</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full min-w-max text-left">
                                <thead class="border-b bg-gray-50">
                                    <tr>
                                        <th class="p-3 text-sm font-semibold text-gray-600">æ—¥æœŸ</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">ä¸»è¦è¡Œç¨‹</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">ä½å®¿</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">äº¤é€š</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 1 (1/30)</td>
                                        <td class="p-3">æŠµé”æ–°åƒæ­² (CTS) â†’ æœ­å¹Œå¸‚å€ â†’ ç‹¸å°è·¯</td>
                                        <td class="p-3">æœ­å¹Œä¸‰ä½ç¥</td>
                                        <td class="p-3">JR / åœ°éµ</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 2 (1/31)</td>
                                        <td class="p-3">åœ“å±±å‹•ç‰©åœ’ â†’ åŒ—æµ·é“ç¥å®® â†’ å¸‚å€è³¼ç‰©</td>
                                        <td class="p-3">æœ­å¹Œä¸‰ä½ç¥</td>
                                        <td class="p-3">åœ°éµ</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 3 (2/1)</td>
                                        <td class="p-3">ç€§é‡éˆ´è˜­å…¬åœ’ â†’ æ”¯ç¬æ¹–å†°æ¿¤ç¯€ â†’ æ´çˆºæ¹–</td>
                                        <td class="p-3">ä¹ƒä¹‹é¢¨åº¦å‡</td>
                                        <td class="p-3">ğŸš— è‡ªé§•</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 4 (2/2)</td>
                                        <td class="p-3">ç™»åˆ¥å°¼å…‹æ–¯ â†’ ç†Šç‰§å ´ â†’ æœ‰ç å±±çºœè»Š</td>
                                        <td class="p-3">stays / å¯å¯é£¯åº—</td>
                                        <td class="p-3">ğŸš— è‡ªé§•</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 5 (2/3)</td>
                                        <td class="p-3">ä¸‰äº• Outlet â†’ æœ­å¹Œ (é‚„è»Š) â†’ æœ­å¹Œé›ªç¥­</td>
                                        <td class="p-3">æ ¼æ‹‰æ–¯éº—æœ­å¹Œ</td>
                                        <td class="p-3">ğŸš— è‡ªé§• / æ­¥è¡Œ</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">Day 6 (2/4)</td>
                                        <td class="p-3">æ–°åƒæ­²æ©Ÿå ´ (è¨­æ–½) â†’ å•Ÿç¨‹è¿”å°</td>
                                        <td class="p-3">N/A</td>
                                        <td class="p-3">JR</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. æ¯æ—¥è¡Œç¨‹ (Itinerary) -->
            <section id="content-itinerary" class="content-section">
                <div class="space-y-6">
                    
                    <!-- Day 1 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 1: 1/30 (å››) â€” æŠµé”æœ­å¹Œ</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>17:20</strong> | æŠµé” <a href="https://maps.google.com/maps?q=New+Chitose+Airport" target="_blank" rel="noopener noreferrer" class="map-link">æ–°åƒæ­²æ©Ÿå ´ (CTS)<span class="map-icon">ğŸ“</span></a></li>
                            <li><strong>18:00</strong> | äº¤é€šï¼š æ­ä¹˜ JR å¿«é€Ÿ Airport è™Ÿ (ç´„ 45-50 åˆ†é˜) å‰å¾€ <a href="https://maps.google.com/maps?q=Sapporo+Station" target="_blank" rel="noopener noreferrer" class="map-link">æœ­å¹Œç«™<span class="map-icon">ğŸ“</span></a></li>
                            <li><strong>18:50</strong> | äº¤é€šï¼š æœ­å¹Œç«™è½‰ä¹˜åœ°éµå—åŒ—ç·š (1 ç«™) è‡³ã€Œå¤§é€šç«™ã€</li>
                            <li><strong>19:15</strong> | å…¥ä½ï¼š <a href="https://maps.google.com/maps?q=Hotel+Trinity+Sapporo" target="_blank" rel="noopener noreferrer" class="map-link">æœ­å¹Œä¸‰ä½ç¥å¤§é£¯åº—<span class="map-icon">ğŸ“</span></a> (é„°è¿‘å¤§é€šå…¬åœ’åŠç‹¸å°è·¯)</li>
                            <li><strong>19:45</strong> | æ™šé¤ï¼š <a href="https://maps.google.com/maps?q=Tanukikoji+Shopping+Street" target="_blank" rel="noopener noreferrer" class="map-link">ç‹¸å°è·¯å•†åº—è¡—<span class="map-icon">ğŸ“</span></a> æˆ–è–„é‡å€åŸŸç”¨é¤ã€‚
                                <button class="ai-recommend-btn" data-location="æœ­å¹Œç‹¸å°è·¯æˆ–è–„é‡" data-id="rec-1">âœ¨ æ¨è–¦é¤å»³</button>
                                <div id="rec-1-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>21:00</strong> | å¤œé–“æ´»å‹•ï¼š ç‹¸å°è·¯å•†åº—è¡— (ä¾‹å¦‚ï¼š24 å°æ™‚ç‡Ÿæ¥­ä¹‹å”å‰è¨¶å¾·)ã€‚</li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>ç•¶æ—¥æ³¨æ„äº‹é …ï¼š</strong> æŠµé”æ©Ÿå ´å¾Œç«‹å³æ›ç©¿ç¦¦å¯’è£å‚™ã€‚å»ºè­°è³¼è²·æˆ–å„²å€¼ IC å¡ (å¦‚ Kitaca / Suica)ã€‚
                        </div>
                    </div>
                    
                    <!-- Day 2 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 2: 1/31 (äº”) â€” æœ­å¹Œå¸‚å€è§€å…‰</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>09:30</strong> | äº¤é€šï¼š å¾é£¯åº— (å¤§é€šç«™) æ­ä¹˜åœ°éµæ±è¥¿ç·š (3 ç«™) å‰å¾€ <a href="https://maps.google.com/maps?q=Maruyama+Park+Sapporo" target="_blank" rel="noopener noreferrer" class="map-link">åœ“å±±å…¬åœ’<span class="map-icon">ğŸ“</span></a></li>
                            <li><strong>10:00</strong> | æ™¯é»ï¼š åƒæ‹œ <a href="https://maps.google.com/maps?q=Hokkaido+Shrine" target="_blank" rel="noopener noreferrer" class="map-link">åŒ—æµ·é“ç¥å®®<span class="map-icon">ğŸ“</span></a></li>
                            <li><strong>11:30</strong> | æ™¯é»ï¼š <a href="https://maps.google.com/maps?q=Maruyama+Zoo" target="_blank" rel="noopener noreferrer" class="map-link">åœ“å±±å‹•ç‰©åœ’<span class="map-icon">ğŸ“</span></a> (å†¬å­£ 16:00 é–‰åœ’)ï¼Œè§€è³å¯’å¸¶å‹•ç‰©ã€‚</li>
                            <li><strong>15:00</strong> | è³¼ç‰©ï¼š æœ­å¹Œå¸‚å€ (PARCOã€<a href="https://maps.google.com/maps?q=Odori+Park" target="_blank" rel="noopener noreferrer" class="map-link">å¤§é€šå…¬åœ’<span class="map-icon">ğŸ“</span></a> å‘¨é‚Šã€æœ­å¹Œåœ°ä¸‹è¡—)ã€‚</li>
                            <li><strong>18:00</strong> | æ™šé¤ï¼š æ¹¯å’–å“© æˆ– æˆå‰æ€æ±—çƒ¤è‚‰ã€‚
                                <button class="ai-recommend-btn" data-location="æœ­å¹Œå¸‚å€ æ¹¯å’–å“© æˆ– æˆå‰æ€æ±—çƒ¤è‚‰" data-id="rec-2">âœ¨ æ¨è–¦é¤å»³</button>
                                <div id="rec-2-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>20:00</strong> | å¤œé–“æ´»å‹•ï¼š å¤§é€šå…¬åœ’æ•£æ­¥ï¼Œè§€è³æœ­å¹Œé›»è¦–å¡” (é›ªç¥­æº–å‚™æœŸ)ã€‚</li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>ç•¶æ—¥æ³¨æ„äº‹é …ï¼š</strong> å…¬åœ’åŠç¥ç¤¾å€åŸŸé›ªåœ°æ¿•æ»‘ï¼Œæ‡‰ç©¿è‘—é˜²æ»‘é›ªé´ã€‚ç†±é–€é¤å»³å»ºè­°ææ—©åˆ°å ´ã€‚åœ°ä¸‹è¡—æ˜¯ä¸å—å¤©å€™å½±éŸ¿çš„è³¼ç‰©å¥½é¸é …ã€‚
                        </div>
                    </div>

                    <!-- Day 3 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 3: 2/1 (å…­) â€” é›ªåœ°æ´»å‹•èˆ‡æ¹–å€ç§»å‹•</h3>
                        <h4 class="text-lg font-semibold text-red-600 mb-3">ğŸš— é–‹å§‹è‡ªé§• ğŸš—</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>08:30</strong> | è‡ªé§•ï¼š æœ­å¹Œå¸‚å€ç§Ÿè»Šé»å‡ºç™¼ (é ç•™ 30-45 åˆ†é˜è¾¦ç†æ‰‹çºŒ)ã€‚</li>
                            <li><strong>09:15</strong> | æ™¯é»ï¼š æŠµé” <a href="https://maps.google.com/maps?q=Takino+Suzuran+Park" target="_blank" rel="noopener noreferrer" class="map-link">åœ‹ç‡Ÿç€§é‡éˆ´è˜­ä¸˜é™µå…¬åœ’<span class="map-icon">ğŸ“</span></a> (è»Šç¨‹ç´„ 45 åˆ†é˜)ã€‚</li>
                            <li><strong>09:30-11:30</strong> | é‡é»è¡Œç¨‹ï¼š é«”é©—é›ªèƒæ»‘é“ (å»ºè­°æ™‚é•·ï¼š2 å°æ™‚)ã€‚</li>
                            <li><strong>11:45</strong> | è‡ªé§•ï¼š å‰å¾€ <a href="https://maps.google.com/maps?q=Lake+Shikotsu" target="_blank" rel="noopener noreferrer" class="map-link">æ”¯ç¬æ¹–<span class="map-icon">ğŸ“</span></a> (è»Šç¨‹ç´„ 45-60 åˆ†é˜)ã€‚</li>
                            <li><strong>12:45-14:15</strong> | æ™¯é»ï¼š æ–¼æ”¯ç¬æ¹–ç•”åˆé¤ & è§€è³ <a href="https://maps.google.com/maps?q=Lake+Shikotsu+Ice+Festival" target="_blank" rel="noopener noreferrer" class="map-link">æ”¯ç¬æ¹–å†°æ¿¤ç¯€<span class="map-icon">ğŸ“</span></a>ã€‚
                                <button class="ai-recommend-btn" data-location="æ”¯ç¬æ¹–ç•” ç°¡é¤" data-id="rec-3">âœ¨ æ¨è–¦é¤å»³</button>
                                <div id="rec-3-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>14:30</strong> | è‡ªé§•ï¼š å‰å¾€ <a href="https://maps.google.com/maps?q=Lake+Toya" target="_blank" rel="noopener noreferrer" class="map-link">æ´çˆºæ¹–<span class="map-icon">ğŸ“</span></a> (è»Šç¨‹ç´„ 1.5 - 2 å°æ™‚)ã€‚</li>
                            <li><strong>16:00-16:30</strong> | å…¥ä½ï¼š <a href="https://maps.google.com/maps?q=Nonokaze+Resort" target="_blank" rel="noopener noreferrer" class="map-link">ä¹ƒä¹‹é¢¨åº¦å‡é£¯åº—<span class="map-icon">ğŸ“</span></a> (å»ºè­°æ–¼æ—¥è½å‰æŠµé”)ã€‚</li>
                            <li><strong>17:00</strong> | æº«æ³‰ï¼š é«”é©—é£¯åº—æº«æ³‰è¨­æ–½ï¼Œæ¬£è³æ¹–æ™¯ã€‚</li>
                            <li><strong>18:00</strong> | æ™šé¤ï¼š é£¯åº—å…§äº«ç”¨æœƒå¸­æ–™ç†ã€‚</li>
                        </ul>
                        <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg">
                            <strong>ç•¶æ—¥æ³¨æ„äº‹é …ï¼š</strong> è¡Œç¨‹ç·Šæ¹Šï¼Œæ‡‰æ§åˆ¶ç€§é‡å…¬åœ’åœç•™æ™‚é–“ã€‚å–è»Šæ™‚æ‡‰ç†Ÿæ‚‰é›ªåˆ·åŠæš–æ°£æ“ä½œã€‚å»ºè­°æ–¼å‚æ™šåŠæ¸…æ™¨é«”é©—é£¯åº—æº«æ³‰ã€‚
                        </div>
                    </div>

                    <!-- Day 4 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 4: 2/2 (æ—¥) â€” é“å—æ™¯é»æ¢è¨ª</h3>
                        <h4 class="text-lg font-semibold text-red-600 mb-3">ğŸš— æŒçºŒè‡ªé§• ğŸš—</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>09:30</strong> | è‡ªé§•ï¼š å‰å¾€ <a href="https://maps.google.com/maps?q=Noboribetsu+Marine+Park+Nixe" target="_blank" rel="noopener noreferrer" class="map-link">ç™»åˆ¥å°¼å…‹æ–¯æµ·æ´‹å…¬åœ’<span class="map-icon">ğŸ“</span></a> (è»Šç¨‹ç´„ 50 åˆ†é˜ - 1 å°æ™‚)ã€‚</li>
                            <li><strong>10:30</strong> | é‡é»è¡Œç¨‹ï¼š è§€è³åœ‹ç‹ä¼éµéŠè¡Œ (æ‡‰æå‰ç¢ºèªæ™‚åˆ»è¡¨)ã€‚</li>
                            <li><strong>12:00</strong> | åˆé¤ï¼š æ–¼ç™»åˆ¥åœ°å€ç”¨é¤ã€‚
                                <button class="ai-recommend-btn" data-location="ç™»åˆ¥åœ°å€" data-id="rec-4">âœ¨ æ¨è–¦é¤å»³</button>
                                <div id="rec-4-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>13:30</strong> | è‡ªé§•ï¼š è¿”å›æ´çˆºæ¹–å€åŸŸï¼Œå‰å¾€ <a href="https://maps.google.com/maps?q=Showa+Shinzan+Bear+Ranch" target="_blank" rel="noopener noreferrer" class="map-link">æ˜­å’Œæ–°å±±ç†Šç‰§å ´<span class="map-icon">ğŸ“</span></a> (è»Šç¨‹ç´„ 50 åˆ†é˜)ã€‚</li>
                            <li><strong>15:00</strong> | æ™¯é»ï¼š <a href="https://maps.google.com/maps?q=Usuzan+Ropeway" target="_blank" rel="noopener noreferrer" class="map-link">æœ‰ç å±±çºœè»Š<span class="map-icon">ğŸ“</span></a> (å†¬å­£ 16:00 æœ«ç­ä¸‹å±±)ï¼Œè§€è³æ´çˆºæ¹–èˆ‡ç«å±±å£ã€‚</li>
                            <li><strong>17:30</strong> | å…¥ä½ï¼š stays / å¯å¯é£¯åº—ã€‚</li>
                        </ul>
                        <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg">
                            <strong>ç•¶æ—¥æ³¨æ„äº‹é …ï¼š</strong> ä¼éµéŠè¡Œç‚ºè¦ªå­é‡é»ï¼Œå»ºè­°ææ—© 20 åˆ†é˜å¡ä½ã€‚æœ‰ç å±±çºœè»Šå¯èƒ½å› å¼·é¢¨åœé§›ï¼Œå±±é ‚é¢¨å¤§å¯’å†·ï¼Œæ³¨æ„å…’ç«¥ä¿æš–ã€‚
                        </div>
                    </div>

                    <!-- Day 5 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 5: 2/3 (ä¸€) â€” è¿”å›æœ­å¹Œèˆ‡é›ªç¥­</h3>
                        <h4 class="text-lg font-semibold text-red-600 mb-3">ğŸš— è‡ªé§•æœ€çµ‚æ—¥ ğŸš—</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>09:30</strong> | è‡ªé§•ï¼š é€€æˆ¿ï¼Œé–‹è»ŠåŒ—ä¸Š (è»Šç¨‹ç´„ 2 - 2.5 å°æ™‚)ã€‚</li>
                            <li><strong>11:30</strong> | è³¼ç‰©ï¼š <a href="https://maps.google.com/maps?q=Mitsui+Outlet+Park+Sapporo+Kitahiroshima" target="_blank" rel="noopener noreferrer" class="map-link">ä¸‰äº• Outlet Park æœ­å¹ŒåŒ—å»£å³¶<span class="map-icon">ğŸ“</span></a> (å«åˆé¤)ã€‚</li>
                            <li><strong>15:30</strong> | è‡ªé§•ï¼š è¿”å›æœ­å¹Œå¸‚å€ (è»Šç¨‹ç´„ 30-40 åˆ†é˜)ï¼Œè¾¦ç†è»Šè¼›æ­¸é‚„ (æ­¸é‚„å‰æ‡‰åŠ æ»¿æ²¹æ–™)ã€‚</li>
                            <li><strong>16:30</strong> | å…¥ä½ï¼š <a href="https://maps.google.com/maps?q=Hotel+Gracery+Sapporo" target="_blank" rel="noopener noreferrer" class="map-link">æ ¼æ‹‰æ–¯éº—æœ­å¹Œé£¯åº—<span class="map-icon">ğŸ“</span></a>ã€‚</li>
                            <li><strong>17:00</strong> | é‡é»è¡Œç¨‹ï¼š <a href="https://maps.google.com/maps?q=Sapporo+Snow+Festival+Odori+Site" target="_blank" rel="noopener noreferrer" class="map-link">æœ­å¹Œé›ªç¥­<span class="map-icon">ğŸ“</span></a> (å¤§é€šæœƒå ´ / è–„é‡æœƒå ´)ã€‚</li>
                            <li><strong>20:00</strong> | æ™šé¤ï¼š æ¹¯å’–å“© æˆ– æˆå‰æ€æ±—çƒ¤è‚‰ã€‚
                                <button class="ai-recommend-btn" data-location="æœ­å¹Œ é è¿‘æœ­å¹Œé›ªç¥­æœƒå ´" data-id="rec-5">âœ¨ æ¨è–¦é¤å»³</button>
                                <div id="rec-5-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>ç•¶æ—¥æ³¨æ„äº‹é …ï¼š</strong> 2/3 æ™šé–“å¯èƒ½ç‚ºé›ªç¥­è©¦ç‡Ÿé‹ï¼Œäººæ½®è¼ƒå°‘ã€‚å¤§é€šæœƒå ´çœ‹é›ªé›•ï¼Œè–„é‡æœƒå ´çœ‹å†°é›•ã€‚å¤œé–“æˆ¶å¤–æ¥µå†·ï¼Œå‚™å¦¥æš–æš–åŒ…åŠè¡Œå‹•é›»æºã€‚
                        </div>
                    </div>

                    <!-- Day 6 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 6: 2/4 (äºŒ) â€” æ©Ÿå ´è¨­æ–½å·¡ç¦®èˆ‡å•Ÿç¨‹</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>08:30</strong> | é€€æˆ¿ï¼Œäº¤é€šï¼š æ­ä¹˜ JR å¿«é€Ÿ Airport è™Ÿ (ç´„ 45-50 åˆ†é˜) å‰å¾€ <a href="https://maps.google.com/maps?q=New+Chitose+Airport" target="_blank" rel="noopener noreferrer" class="map-link">æ–°åƒæ­²æ©Ÿå ´<span class="map-icon">ğŸ“</span></a>ã€‚</li>
                            <li><strong>10:30</strong> | æ™¯é»ï¼š æ–°åƒæ­²æ©Ÿå ´ (CTS)ã€‚</li>
                            <li><strong>11:00</strong> | é‡é»è¡Œç¨‹ï¼š Royce' å·§å…‹åŠ›ä¸–ç•Œã€<a href="https://maps.google.com/maps?q=Doraemon+Waku+Waku+Sky+Park" target="_blank" rel="noopener noreferrer" class="map-link">å“†å•¦Aå¤¢ç©ºä¸­æ¨‚åœ’<span class="map-icon">ğŸ“</span></a> (10:00 é–‹æ”¾)ã€‚</li>
                            <li><strong>13:00</strong> | æ©Ÿå ´åˆé¤ (ä¾‹å¦‚ï¼šåŒ—æµ·é“æ‹‰éºµé“å ´) åŠ æ¡è³¼ä¼´æ‰‹ç¦®ã€‚</li>
                            <li><strong>14:40</strong> | ğŸ›« å•Ÿç¨‹è¿”å°ã€‚</li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>ç•¶æ—¥æ³¨æ„äº‹é …ï¼š</strong> æ–°åƒæ­²æ©Ÿå ´è¨­æ–½è±å¯Œï¼Œå»ºè­°è‡³å°‘ææ—© 3.5 å°æ™‚æŠµé”ï¼Œä»¥é ç•™å……è¶³æ™‚é–“é«”é©—åŠè¾¦ç†ç™»æ©Ÿæ‰‹çºŒã€‚
                        </div>
                    </div>

                </div>
            </section>

            <!-- 3. é›ªåœ°å®‰å…¨ (Safety) -->
            <section id="content-safety" class="content-section">
                <h2 class="text-2xl font-bold text-red-700 mb-4">å†¬å­£é§•é§›å®‰å…¨è¦ç¯„</h2>
                <p class="text-gray-700 mb-4">æœ¬è¡Œç¨‹åŒ…å«ä¸‰æ—¥é›ªåœ°è‡ªé§•ï¼Œæ­¤ç‚ºé«”é©—åŒ—æµ·é“å†¬å­£æ™¯è§€ä¹‹æœ‰æ•ˆæ–¹å¼ï¼Œç„¶é ˆä»¥å®‰å…¨ç‚ºæœ€é«˜å‰æã€‚</p>
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg border">
                        <h3 class="text-lg font-semibold text-gray-800">è»Šè¼›è¦æ ¼</h3>
                        <p class="text-gray-700">å¿…é ˆç§Ÿç”¨ <span class="font-bold text-red-600">4WD (å››è¼ªé©…å‹•)</span> ä¸¦é…å‚™ <span class="font-bold text-red-600">é›ªèƒ (Studless Tire)</span> ä¹‹è»Šæ¬¾ã€‚</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg border">
                        <h3 class="text-lg font-semibold text-gray-800">è¡Œè»Šé€Ÿåº¦èˆ‡è»Šè·</h3>
                        <p class="text-gray-700">å»ºè­°æœ€é«˜æ™‚é€Ÿæ‡‰æ§åˆ¶æ–¼ <span class="font-bold">50-60 å…¬é‡Œ/å°æ™‚</span>ã€‚å®‰å…¨è»Šè·æ‡‰ç¶­æŒç‚ºå¹³æ™‚çš„ 2-3 å€ã€‚</p>
                    </div>
                    <div class="p-4 bg-yellow-100 border border-yellow-300 rounded-lg">
                        <h3 class="text-lg font-semibold text-yellow-800">æ½›åœ¨å±éšªï¼š é»‘å†° (Black Ice)</h3>
                        <p class="text-yellow-700">è·¯é¢çœ‹ä¼¼æ¿•æ»‘ï¼Œå¯¦ç‚ºè–„å†°ï¼Œæ˜¯ä¸»è¦é¢¨éšªä¾†æºã€‚è¡Œç¶“<span class="font-bold">æ©‹æ¨‘ã€éš§é“å£ã€èƒŒé™°è™•</span>æ™‚æ‡‰ç‰¹åˆ¥æ³¨æ„ï¼Œé¿å…åœ¨é€™äº›è·¯æ®µæ€¥ç…è»Šæˆ–æ€¥è½‰å‘ã€‚</p>
                    </div>
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800">æ™‚é–“ç®¡ç†</h3>
                        <p class="text-blue-700">åŒ—æµ·é“å†¬å­£ç´„æ–¼ <span class="font-bold">16:00</span> å¤©è‰²é–‹å§‹æ˜æš—ã€‚æ‡‰è¦åŠƒæ–¼æ—¥è½å‰æŠµé”ç•¶æ—¥ä½å®¿é»ï¼Œ<span class="font-bold">é¿å…å¤œé–“é§•é§›</span>ã€‚</p>
                    </div>
                </div>
            </section>

            <!-- 4. è£å‚™æ¸…å–® (Gear) -->
            <section id="content-gear" class="content-section">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">å†¬å­£é—œéµè£å‚™æ¸…å–®</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- è¡£ç‰© -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">è¡£ç‰© (æ´‹è”¥å¼ç©¿æ­)</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li><span class="font-semibold text-blue-700">[å¤–å±¤]</span> é˜²æ°´é˜²é¢¨å¤–å¥— (æ»‘é›ªå¤–å¥—ç‚ºä½³)</li>
                            <li><span class="font-semibold text-blue-700">[ä¸­å±¤]</span> åˆ·æ¯› (Fleece) æˆ–è¼•ç¾½çµ¨</li>
                            <li><span class="font-semibold text-blue-700">[åº•å±¤]</span> ä¿æš–æ’æ±—åº•å±¤è¡£è¤²</li>
                        </ul>
                    </div>
                    <!-- è¶³éƒ¨èˆ‡é…ä»¶ -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">è¶³éƒ¨èˆ‡é…ä»¶</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li class="font-bold text-red-600">é˜²æ°´é˜²æ»‘é«˜ç­’é›ªé´ (é—œéµè£Wå‚™)</li>
                            <li>æ¯›å¸½ (å¯é®è€³)</li>
                            <li>é˜²æ°´æ‰‹å¥—</li>
                            <li>åœå·¾ (æˆ–è„–åœ)</li>
                        </ul>
                    </div>
                    <!-- å…’ç«¥å°ˆå€ -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">å…’ç«¥å°ˆå€</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li>é€£èº«é›ªè¡£æˆ–é›ªè¤² (é©ç”¨æ–¼é›ªåœ°æ´»å‹•)</li>
                            <li>å‚™ç”¨æ‰‹å¥— (æ˜“æ¿•)</li>
                            <li>å¤ªé™½çœ¼é¡ (é˜²æ­¢é›ªåœ°åå…‰)</li>
                        </ul>
                    </div>
                    <!-- å…¶ä»– -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">å…¶ä»–</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li>è¡Œå‹•é›»æº (ä½æº«æ˜“è€—é›»)</li>
                            <li>æš–æš–åŒ…</li>
                            <li><span class="font-semibold text-green-700">[è‡ªé§•]</span> å°ç£é§•ç…§æ­£æœ¬ã€æ—¥æ–‡è­¯æœ¬ã€è­·ç…§</li>
                            <li>ä¿æ¿•ä¹³æ¶² / è­·å”‡è†</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 5. å½ˆæ€§å»ºè­° (Options) -->
            <section id="content-options" class="content-section">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">å½ˆæ€§è¡Œç¨‹å»ºè­°</h2>
                <div class="space-y-4">
                    <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                        <h3 class="text-lg font-semibold text-green-800">è¦ªå­é›ªåœ°æ´»å‹•</h3>
                        <p class="text-green-700">ç›®å‰è¡Œç¨‹ä»¥è§€è³é›ªæ™¯ç‚ºä¸»ã€‚å»ºè­°æ–¼ Day 3 (æ”¯ç¬æ¹–) æˆ– Day 4 (æ´çˆºæ¹–) ç•”ï¼Œå°‹æ‰¾å®‰å…¨çš„ç©é›ªå€åŸŸï¼Œä¿ç•™ 30-60 åˆ†é˜é€²è¡Œå †é›ªäººç­‰è¦ªå­æ´»å‹•ï¼Œå¯æ”œå¸¶ç°¡æ˜“ç©æ²™å·¥å…·ã€‚</p>
                    </div>
                    <div class="p-4 bg-pink-50 rounded-lg border border-pink-200">
                        <h3 class="text-lg font-semibold text-pink-800">æœ­å¹Œå¸‚å€ç”œé»é«”é©—</h3>
                        <p class="text-pink-700">æ–¼ Day 2 æˆ– Day 5 åœ¨æœ­å¹Œå¸‚å€æ™‚ï¼Œå¯è€ƒæ…®å®‰æ’å“åšåœ¨åœ°çŸ¥åç”œé»ï¼ˆä¾‹å¦‚ï¼šKINOTOYA BAKE èµ·å¸å¡”ã€æ¤¿ã‚µãƒ­ãƒ³ èˆ’èŠ™è•¾é¬†é¤…ï¼‰ï¼Œå¢åŠ è¡Œç¨‹è±å¯Œæ€§ã€‚</p>
                    </div>
                    <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
                        <h3 class="text-lg font-semibold text-orange-800">å¢è¨­ä¸­é€”ä¼‘æ¯é»</h3>
                        <p class="text-orange-700">åœ¨é•·é€”è‡ªé§•æ—¥ï¼Œå¯åˆ©ç”¨ã€Œé“ã®é§…ã€(å…¬è·¯ä¼‘æ¯ç«™) é€²è¡ŒçŸ­æš«ä¼‘æ¯ï¼Œè®“å…’ç«¥ä¸‹è»Šæ´»å‹•ï¼Œä¸¦å“åšç•¶åœ°å°åƒï¼Œä»¥ç·©è§£ä¹˜è»Šç–²å‹ã€‚</p>
</div>
                </div>
            </section>
        </main>
        
        <!-- é å°¾ -->
        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>æ­¤å ±å‘Šç”± AI å”åŒç”¢ç”Ÿï¼Œåƒ…ä¾›è¦åŠƒåƒè€ƒã€‚æ‰€æœ‰æ™‚é–“ã€åº—å®¶è³‡è¨ŠåŠæ´»å‹•å…§å®¹æ‡‰ä»¥å¯¦éš›æƒ…æ³ç‚ºæº–ã€‚</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- å°è¦½åˆ—åˆ†é åˆ‡æ› ---
            const tabs = document.querySelectorAll('.nav-tab');
            const sections = document.querySelectorAll('.content-section');
            const previewToggleButton = document.getElementById('preview-toggle');
            const previewBanner = document.getElementById('preview-banner');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    const isPreviewMode = document.body.classList.contains('preview-mode');

                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    if (isPreviewMode) {
                        const targetSection = document.getElementById(`content-${tabId}`);
                        targetSection?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        return;
                    }

                    sections.forEach(section => section.classList.remove('active'));
                    document.getElementById(`content-${tabId}`).classList.add('active');
                });
            });

            if (previewToggleButton) {
                const updatePreviewButtonLabel = (isPreviewMode) => {
                    previewToggleButton.textContent = isPreviewMode ? 'è¿”å›åˆ†é æ¨¡å¼' : 'é è¦½æ¨¡å¼';
                    previewToggleButton.setAttribute('aria-pressed', String(isPreviewMode));
                };

                updatePreviewButtonLabel(false);
                if (previewBanner) {
                    previewBanner.hidden = true;
                }

                previewToggleButton.addEventListener('click', () => {
                    const isPreviewMode = document.body.classList.toggle('preview-mode');
                    updatePreviewButtonLabel(isPreviewMode);
                    if (previewBanner) {
                        previewBanner.hidden = !isPreviewMode;
                    }

                    if (!isPreviewMode) {
                        // ç•¶é›¢é–‹é è¦½æ¨¡å¼æ™‚ï¼Œç¢ºä¿ç•¶å‰é¸å–çš„åˆ†é å…§å®¹é¡¯ç¤º
                        const activeTab = document.querySelector('.nav-tab.active');
                        const activeTabId = activeTab?.getAttribute('data-tab') || 'overview';

                        sections.forEach(section => {
                            if (section.id === `content-${activeTabId}`) {
                                section.classList.add('active');
                            } else {
                                section.classList.remove('active');
                            }
                        });
                    }
                });
            }

            // --- Gemini API é‡‘é‘° (è«‹ç•™ç©ºï¼Œç”± Canvas æä¾›) ---
            const apiKey = "";
            const genaiModel = "gemini-2.5-flash-preview-09-2025";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${genaiModel}:generateContent?key=${apiKey}`;

            // --- æŒ‡æ•¸é€€é¿é‡è©¦å‡½å¼ ---
            async function fetchWithExponentialBackoff(url, payload, retries = 5, delay = 1000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 || response.status >= 500) {
                                // è§¸ç™¼é‡è©¦
                                throw new Error(`Retryable error: ${response.status}`);
                            } else {
                                // ä¸å¯é‡è©¦çš„éŒ¯èª¤
                                const errorResult = await response.json().catch(() => ({}));
                                const errorText = errorResult.error?.message || `HTTP error! status: ${response.status}`;
                                return { error: `API è«‹æ±‚å¤±æ•—: ${errorText}` };
                            }
                        }
                        
                        const result = await response.json();
                        return { data: result };

                    } catch (error) {
                        if (i === retries - 1) {
                            // æœ€å¾Œä¸€æ¬¡é‡è©¦å¤±æ•—
                            return { error: `API è«‹æ±‚å¤±æ•—ï¼Œå·²é”é‡è©¦ä¸Šé™: ${error.message}` };
                        }
                        // ç­‰å¾…å¾Œé‡è©¦
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // æŒ‡æ•¸å¢åŠ å»¶é²
                    }
                }
                return { error: "API è«‹æ±‚å¤±æ•—ï¼Œå·²é”é‡è©¦ä¸Šé™ã€‚" };
            }

            // --- è™•ç† AI æ¨è–¦ ---
            async function getRestaurantRecommendation(location, button, resultDiv) {
                if (!apiKey && apiKey.length === 0) {
                    console.error("Gemini API é‡‘é‘°æœªè¨­å®šã€‚");
                    resultDiv.innerHTML = "æŠ±æ­‰ï¼ŒAI æ¨è–¦åŠŸèƒ½ç›®å‰ç„¡æ³•ä½¿ç”¨ (API é‡‘é‘°æœªè¨­å®š)ã€‚";
                    resultDiv.style.display = 'block';
                    button.classList.remove('loading');
                    button.disabled = false;
                    return;
                }
                
                button.classList.add('loading');
                button.disabled = true;
                resultDiv.innerHTML = "âœ¨ AI æœå°‹ä¸­ï¼Œè«‹ç¨å€™...";
                resultDiv.style.display = 'block';

                const userQuery = `
                    å°‹æ‰¾ 1-2 å®¶åœ¨ã€Œ${location}ã€é™„è¿‘ï¼Œé©åˆå®¶åº­ (æœ‰ 7, 5, 3 æ­²å°å­©) çš„é¤å»³ã€‚
                    è«‹æä¾›é¤å»³åç¨±å’Œä¸€å¥è©±çš„ç°¡çŸ­ç†ç”±ã€‚
                    ä½¿ç”¨ Google æœå°‹å·¥å…·ã€‚
                `;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: "ä½ æ˜¯ä¸€ä½å‹å–„çš„åŒ—æµ·é“æ—…è¡ŒåŠ©ç†ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›è¦†ã€‚å›è¦†æ‡‰ç°¡æ½”ã€å…·é«”ï¼Œä¸¦å°ˆæ³¨æ–¼ä½¿ç”¨è€…çš„è¦æ±‚ã€‚" }]
                    },
                };

                const { data, error } = await fetchWithExponentialBackoff(apiUrl, payload);

                button.classList.remove('loading');
                button.disabled = false;

                if (error) {
                    console.error('Gemini API å‘¼å«å¤±æ•—:', error);
                    resultDiv.innerHTML = `æŠ±æ­‰ï¼Œæ¨è–¦æ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚<br>(${error})`;
                    return;
                }

                try {
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) {
                        // å°‡ AI å›è¦†ä¸­çš„æ›è¡Œç¬¦è™Ÿè½‰ç‚º HTML <br>
                        resultDiv.innerHTML = text.replace(/\n/g, '<br>');
                    } else {
                        resultDiv.innerHTML = "æŠ±æ­‰ï¼ŒAI æ²’æœ‰å›å‚³æœ‰æ•ˆçš„æ¨è–¦ã€‚";
                    }
                } catch (e) {
                    console.error('è§£æ AI å›è¦†å¤±æ•—:', e);
                    resultDiv.innerHTML = "æŠ±æ­‰ï¼Œè§£æ AI å›è¦†æ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚";
                }
            }

            // --- å¹«æ‰€æœ‰æ¨è–¦æŒ‰éˆ•åŠ ä¸Šç›£è½å™¨ ---
            document.querySelectorAll('.ai-recommend-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const location = button.dataset.location;
                    const resultDivId = button.dataset.id + '-result';
                    const resultDiv = document.getElementById(resultDivId);
                    
                    // å¦‚æœå·²ç¶“æœ‰å…§å®¹ï¼Œå†æ¬¡é»æ“Šå°±éš±è—/é¡¯ç¤º
                    if (resultDiv.innerHTML !== "" && !button.disabled) {
                        resultDiv.style.display = (resultDiv.style.display === 'none') ? 'block' : 'none';
                    } else if (!button.disabled) {
                        getRestaurantRecommendation(location, button, resultDiv);
                    }
                });
            });

        });
    </script>
</body>
</html>
