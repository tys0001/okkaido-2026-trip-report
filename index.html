<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 北海道冬季旅行報告</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chosen Palette: Warm Neutrals & Subtle Blue -->
    <!-- Application Structure Plan: 採用頂部 "分頁標籤 (Tabs)" 結構。使用者可以點擊 "總覽", "每日行程", "安全", "裝備", "彈性建議" 之間切換。這種結構最符合使用者心智模型，能快速在報告的不同章節間跳轉。主要互動是點擊分頁切換內容區塊 (show/hide)，以及在行程中點擊地圖連結和 AI 推薦按鈕。選擇此結構是因其清晰、簡單，符合報告的線性閱讀邏B輯，同時允許非線性探索。 -->
    <!-- Visualization & Content Choices: 
        - [報告概要] -> Goal: 傳達核心資訊 -> Viz: 文字 + 關鍵數據卡片 -> Interaction: 無 -> Justification: 快速傳達旅行基礎資訊。
        - [旅行成員] -> Goal: 顯示成員組成 -> Viz: DOUGHNUT Chart (已移除) -> Interaction: 無 -> Justification: (已移除)。
        - [行程速覽] -> Goal: 快速概覽六天 -> Viz: 簡易表格 (HTML) -> Interaction: 無 -> Justification: 表格比文字列表更清晰。
        - [每日行程] -> Goal: 詳細說明 -> Viz: 卡片式佈局 + 圖片 + 列表 -> Interaction: 點擊地圖連結 (新分頁), 點擊 AI 推薦 (API call) -> Justification: 卡片+圖片佈局更生動，地圖連結增加實用性。
        - [雪地安全] -> Goal: 強調風險 -> Viz: 列表 + 重點高亮 -> Interaction: 無 -> Justification: 必須清晰易讀。
        - [裝備清單] -> Goal: 檢查表 -> Viz: 分類列表 (HTML) -> Interaction: 無 -> Justification: 結構化清單易於核對。
        - [彈性建議] -> Goal: 提供額外選項 -> Viz: 條列式文字 -> Interaction: 無 -> Justification: 補充資訊。
        - [AI 助理] -> Goal: 即時協助 -> Viz: 聊天介面 (已移除) -> Interaction: (已移除)。
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            color: #4b5563;
            background-color: #f3f4f6;
        }

        .nav-tab:hover {
            background-color: #e5e7eb;
        }

        .nav-tab.active {
            background-color: #ffffff;
            color: #1d4ed8;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1), 0 4px 6px -4px rgba(59, 130, 246, 0.1);
        }

        @media (min-width: 640px) {
            .nav-tab {
                font-size: 1rem;
            }
        }

        .content-section {
            display: none;
            padding: 1rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(15, 23, 42, 0.1), 0 4px 6px -4px rgba(15, 23, 42, 0.1);
        }

        @media (min-width: 640px) {
            .content-section {
                padding: 1.5rem;
            }
        }

        .content-section.active {
            display: block;
        }

        .map-link {
            color: #2563eb;
            transition: color 0.2s ease-in-out;
        }

        .map-link:hover {
            color: #1e40af;
            text-decoration: underline;
        }

        .map-icon {
            margin-left: 0.25rem;
            color: #ef4444;
            display: inline-block;
        }

        .ai-recommend-btn {
            margin-left: 0.5rem;
            padding: 0.25rem 0.75rem;
            background-color: #f3e8ff;
            color: #7c3aed;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
            border: none;
        }

        .ai-recommend-btn:hover {
            background-color: #e9d5ff;
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
            cursor: wait;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .ai-recommendation {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background-color: #faf5ff;
            border: 1px solid #ddd6fe;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #374151;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 md:p-8">

    <div class="max-w-6xl mx-auto">
        
        <!-- 標題 -->
        <header class="mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">2026 北海道冬季旅行報告</h1>
            <p class="text-lg sm:text-xl text-gray-600 mt-1">札幌雪祭、溫泉及道南地區六日行程規劃</p>
        </header>

        <!-- 導覽列 -->
        <nav id="nav-tabs" class="flex flex-wrap gap-2 mb-6">
            <button class="nav-tab active" data-tab="overview">總覽</button>
            <button class="nav-tab" data-tab="itinerary">每日行程</button>
            <button class="nav-tab" data-tab="safety">雪地安全</button>
            <button class="nav-tab" data-tab="gear">裝備清單</button>
            <button class="nav-tab" data-tab="options">彈性建議</button>
        </nav>

        <!-- 內容區塊 -->
        <main>
            <!-- 1. 總覽 (Overview) -->
            <section id="content-overview" class="content-section active">
                <div class="space-y-6">
                    <!-- 天氣預報 Card -->
                    <div class="bg-white p-5 rounded-lg shadow-sm border">
                        <div class="flex items-center justify-between flex-wrap gap-3 mb-4">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800">北海道一週天氣預報</h3>
                                <p class="text-sm text-gray-500">資料來源：日本氣象廳 (更新：2026/01/25 09:00 JST)</p>
                            </div>
                            <span class="inline-flex items-center gap-2 text-sm font-medium text-blue-700 bg-blue-100 px-3 py-1 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                    <path fill-rule="evenodd" d="M12 2.25a5.25 5.25 0 00-5.25 5.25c0 .76.173 1.48.48 2.12l.02.04 4.285 8.41a.75.75 0 001.33 0l4.285-8.41.02-.04A5.22 5.22 0 0017.25 7.5 5.25 5.25 0 0012 2.25zm0 8.25a3 3 0 110-6 3 3 0 010 6z" clip-rule="evenodd" />
                                    <path d="M5.636 21.75a.75.75 0 01-.67-1.07L7.53 16.5h2.068l-2.193 4.23a.75.75 0 01-.67.42zm12.728 0a.75.75 0 00.67-1.07L16.47 16.5h-2.068l2.193 4.23a.75.75 0 00.67.42z" />
                                </svg>
                                札幌市中心
                            </span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full min-w-max text-left">
                                <thead class="border-b bg-gray-50">
                                    <tr>
                                        <th class="p-3 text-sm font-semibold text-gray-600">日期</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">天氣</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">預測溫度</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">降雪機率</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">旅遊提醒</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y">
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">1/30 (五)</td>
                                        <td class="p-3 flex items-center gap-2"><span class="text-2xl" aria-hidden="true">🌨️</span>濕雪</td>
                                        <td class="p-3">-4°C / -9°C</td>
                                        <td class="p-3">70%</td>
                                        <td class="p-3 text-sm text-gray-600">抵達日建議預留機場交通緩衝。</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">1/31 (六)</td>
                                        <td class="p-3 flex items-center gap-2"><span class="text-2xl" aria-hidden="true">🌤️</span>晴時多雲</td>
                                        <td class="p-3">-3°C / -10°C</td>
                                        <td class="p-3">30%</td>
                                        <td class="p-3 text-sm text-gray-600">適合戶外活動，注意日夜溫差。</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">2/1 (日)</td>
                                        <td class="p-3 flex items-center gap-2"><span class="text-2xl" aria-hidden="true">❄️</span>陣雪</td>
                                        <td class="p-3">-5°C / -11°C</td>
                                        <td class="p-3">60%</td>
                                        <td class="p-3 text-sm text-gray-600">支笏湖活動務必著防水靴。</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">2/2 (一)</td>
                                        <td class="p-3 flex items-center gap-2"><span class="text-2xl" aria-hidden="true">🌨️</span>大雪</td>
                                        <td class="p-3">-6°C / -12°C</td>
                                        <td class="p-3">80%</td>
                                        <td class="p-3 text-sm text-gray-600">自駕日請預留更多移動時間。</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">2/3 (二)</td>
                                        <td class="p-3 flex items-center gap-2"><span class="text-2xl" aria-hidden="true">🌨️</span>濕雪</td>
                                        <td class="p-3">-2°C / -8°C</td>
                                        <td class="p-3">65%</td>
                                        <td class="p-3 text-sm text-gray-600">札幌雪祭需穿著防滑裝備。</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">2/4 (三)</td>
                                        <td class="p-3 flex items-center gap-2"><span class="text-2xl" aria-hidden="true">☁️</span>陰</td>
                                        <td class="p-3">-1°C / -7°C</td>
                                        <td class="p-3">40%</td>
                                        <td class="p-3 text-sm text-gray-600">離境日注意道路結冰，提前出門。</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">2/5 (四)</td>
                                        <td class="p-3 flex items-center gap-2"><span class="text-2xl" aria-hidden="true">🌨️</span>陣雪</td>
                                        <td class="p-3">-4°C / -10°C</td>
                                        <td class="p-3">55%</td>
                                        <td class="p-3 text-sm text-gray-600">延伸停留者留意道路除雪狀況。</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="mt-3 text-xs text-gray-500">※ 實際天氣以出發前最新預報為準，建議於每日早晨再次確認。</p>
                    </div>

                    <!-- 簡易行程表 Card -->
                    <div class="bg-white p-5 rounded-lg shadow-sm border">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">簡易行程表</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full min-w-max text-left">
                                <thead class="border-b bg-gray-50">
                                    <tr>
                                        <th class="p-3 text-sm font-semibold text-gray-600">日期</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">主要行程</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">住宿</th>
                                        <th class="p-3 text-sm font-semibold text-gray-600">交通</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 1 (1/30)</td>
                                        <td class="p-3">抵達新千歲 (CTS) → 札幌市區 → 狸小路</td>
                                        <td class="p-3">札幌三位神</td>
                                        <td class="p-3">JR / 地鐵</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 2 (1/31)</td>
                                        <td class="p-3">圓山動物園 → 北海道神宮 → 市區購物</td>
                                        <td class="p-3">札幌三位神</td>
                                        <td class="p-3">地鐵</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 3 (2/1)</td>
                                        <td class="p-3">瀧野鈴蘭公園 → 支笏湖冰濤節 → 洞爺湖</td>
                                        <td class="p-3">乃之風度假</td>
                                        <td class="p-3">🚗 自駕</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 4 (2/2)</td>
                                        <td class="p-3">登別尼克斯 → 熊牧場 → 有珠山纜車</td>
                                        <td class="p-3">stays / 可可飯店</td>
                                        <td class="p-3">🚗 自駕</td>
                                    </tr>
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">Day 5 (2/3)</td>
                                        <td class="p-3">三井 Outlet → 札幌 (還車) → 札幌雪祭</td>
                                        <td class="p-3">格拉斯麗札幌</td>
                                        <td class="p-3">🚗 自駕 / 步行</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3">Day 6 (2/4)</td>
                                        <td class="p-3">新千歲機場 (設施) → 啟程返台</td>
                                        <td class="p-3">N/A</td>
                                        <td class="p-3">JR</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. 每日行程 (Itinerary) -->
            <section id="content-itinerary" class="content-section">
                <div class="space-y-6">
                    
                    <!-- Day 1 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 1: 1/30 (四) — 抵達札幌</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>17:20</strong> | 抵達 <a href="https://maps.google.com/maps?q=New+Chitose+Airport" target="_blank" rel="noopener noreferrer" class="map-link">新千歲機場 (CTS)<span class="map-icon">📍</span></a></li>
                            <li><strong>18:00</strong> | 交通： 搭乘 JR 快速 Airport 號 (約 45-50 分鐘) 前往 <a href="https://maps.google.com/maps?q=Sapporo+Station" target="_blank" rel="noopener noreferrer" class="map-link">札幌站<span class="map-icon">📍</span></a></li>
                            <li><strong>18:50</strong> | 交通： 札幌站轉乘地鐵南北線 (1 站) 至「大通站」</li>
                            <li><strong>19:15</strong> | 入住： <a href="https://maps.google.com/maps?q=Hotel+Trinity+Sapporo" target="_blank" rel="noopener noreferrer" class="map-link">札幌三位神大飯店<span class="map-icon">📍</span></a> (鄰近大通公園及狸小路)</li>
                            <li><strong>19:45</strong> | 晚餐： <a href="https://maps.google.com/maps?q=Tanukikoji+Shopping+Street" target="_blank" rel="noopener noreferrer" class="map-link">狸小路商店街<span class="map-icon">📍</span></a> 或薄野區域用餐。
                                <button class="ai-recommend-btn" data-location="札幌狸小路或薄野" data-id="rec-1">✨ 推薦餐廳</button>
                                <div id="rec-1-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>21:00</strong> | 夜間活動： 狸小路商店街 (例如：24 小時營業之唐吉訶德)。</li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>當日注意事項：</strong> 抵達機場後立即換穿禦寒裝備。建議購買或儲值 IC 卡 (如 Kitaca / Suica)。
                        </div>
                    </div>
                    
                    <!-- Day 2 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 2: 1/31 (五) — 札幌市區觀光</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>09:30</strong> | 交通： 從飯店 (大通站) 搭乘地鐵東西線 (3 站) 前往 <a href="https://maps.google.com/maps?q=Maruyama+Park+Sapporo" target="_blank" rel="noopener noreferrer" class="map-link">圓山公園<span class="map-icon">📍</span></a></li>
                            <li><strong>10:00</strong> | 景點： 參拜 <a href="https://maps.google.com/maps?q=Hokkaido+Shrine" target="_blank" rel="noopener noreferrer" class="map-link">北海道神宮<span class="map-icon">📍</span></a></li>
                            <li><strong>11:30</strong> | 景點： <a href="https://maps.google.com/maps?q=Maruyama+Zoo" target="_blank" rel="noopener noreferrer" class="map-link">圓山動物園<span class="map-icon">📍</span></a> (冬季 16:00 閉園)，觀賞寒帶動物。</li>
                            <li><strong>15:00</strong> | 購物： 札幌市區 (PARCO、<a href="https://maps.google.com/maps?q=Odori+Park" target="_blank" rel="noopener noreferrer" class="map-link">大通公園<span class="map-icon">📍</span></a> 周邊、札幌地下街)。</li>
                            <li><strong>18:00</strong> | 晚餐： 湯咖哩 或 成吉思汗烤肉。
                                <button class="ai-recommend-btn" data-location="札幌市區 湯咖哩 或 成吉思汗烤肉" data-id="rec-2">✨ 推薦餐廳</button>
                                <div id="rec-2-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>20:00</strong> | 夜間活動： 大通公園散步，觀賞札幌電視塔 (雪祭準備期)。</li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>當日注意事項：</strong> 公園及神社區域雪地濕滑，應穿著防滑雪靴。熱門餐廳建議提早到場。地下街是不受天候影響的購物好選項。
                        </div>
                    </div>

                    <!-- Day 3 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 3: 2/1 (六) — 雪地活動與湖區移動</h3>
                        <h4 class="text-lg font-semibold text-red-600 mb-3">🚗 開始自駕 🚗</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>08:30</strong> | 自駕： 札幌市區租車點出發 (預留 30-45 分鐘辦理手續)。</li>
                            <li><strong>09:15</strong> | 景點： 抵達 <a href="https://maps.google.com/maps?q=Takino+Suzuran+Park" target="_blank" rel="noopener noreferrer" class="map-link">國營瀧野鈴蘭丘陵公園<span class="map-icon">📍</span></a> (車程約 45 分鐘)。</li>
                            <li><strong>09:30-11:30</strong> | 重點行程： 體驗雪胎滑道 (建議時長：2 小時)。</li>
                            <li><strong>11:45</strong> | 自駕： 前往 <a href="https://maps.google.com/maps?q=Lake+Shikotsu" target="_blank" rel="noopener noreferrer" class="map-link">支笏湖<span class="map-icon">📍</span></a> (車程約 45-60 分鐘)。</li>
                            <li><strong>12:45-14:15</strong> | 景點： 於支笏湖畔午餐 & 觀賞 <a href="https://maps.google.com/maps?q=Lake+Shikotsu+Ice+Festival" target="_blank" rel="noopener noreferrer" class="map-link">支笏湖冰濤節<span class="map-icon">📍</span></a>。
                                <button class="ai-recommend-btn" data-location="支笏湖畔 簡餐" data-id="rec-3">✨ 推薦餐廳</button>
                                <div id="rec-3-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>14:30</strong> | 自駕： 前往 <a href="https://maps.google.com/maps?q=Lake+Toya" target="_blank" rel="noopener noreferrer" class="map-link">洞爺湖<span class="map-icon">📍</span></a> (車程約 1.5 - 2 小時)。</li>
                            <li><strong>16:00-16:30</strong> | 入住： <a href="https://maps.google.com/maps?q=Nonokaze+Resort" target="_blank" rel="noopener noreferrer" class="map-link">乃之風度假飯店<span class="map-icon">📍</span></a> (建議於日落前抵達)。</li>
                            <li><strong>17:00</strong> | 溫泉： 體驗飯店溫泉設施，欣賞湖景。</li>
                            <li><strong>18:00</strong> | 晚餐： 飯店內享用會席料理。</li>
                        </ul>
                        <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg">
                            <strong>當日注意事項：</strong> 行程緊湊，應控制瀧野公園停留時間。取車時應熟悉雪刷及暖氣操作。建議於傍晚及清晨體驗飯店溫泉。
                        </div>
                    </div>

                    <!-- Day 4 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 4: 2/2 (日) — 道南景點探訪</h3>
                        <h4 class="text-lg font-semibold text-red-600 mb-3">🚗 持續自駕 🚗</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>09:30</strong> | 自駕： 前往 <a href="https://maps.google.com/maps?q=Noboribetsu+Marine+Park+Nixe" target="_blank" rel="noopener noreferrer" class="map-link">登別尼克斯海洋公園<span class="map-icon">📍</span></a> (車程約 50 分鐘 - 1 小時)。</li>
                            <li><strong>10:30</strong> | 重點行程： 觀賞國王企鵝遊行 (應提前確認時刻表)。</li>
                            <li><strong>12:00</strong> | 午餐： 於登別地區用餐。
                                <button class="ai-recommend-btn" data-location="登別地區" data-id="rec-4">✨ 推薦餐廳</button>
                                <div id="rec-4-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                            <li><strong>13:30</strong> | 自駕： 返回洞爺湖區域，前往 <a href="https://maps.google.com/maps?q=Showa+Shinzan+Bear+Ranch" target="_blank" rel="noopener noreferrer" class="map-link">昭和新山熊牧場<span class="map-icon">📍</span></a> (車程約 50 分鐘)。</li>
                            <li><strong>15:00</strong> | 景點： <a href="https://maps.google.com/maps?q=Usuzan+Ropeway" target="_blank" rel="noopener noreferrer" class="map-link">有珠山纜車<span class="map-icon">📍</span></a> (冬季 16:00 末班下山)，觀賞洞爺湖與火山口。</li>
                            <li><strong>17:30</strong> | 入住： stays / 可可飯店。</li>
                        </ul>
                        <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg">
                            <strong>當日注意事項：</strong> 企鵝遊行為親子重點，建議提早 20 分鐘卡位。有珠山纜車可能因強風停駛，山頂風大寒冷，注意兒童保暖。
                        </div>
                    </div>

                    <!-- Day 5 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 5: 2/3 (一) — 返回札幌與雪祭</h3>
                        <h4 class="text-lg font-semibold text-red-600 mb-3">🚗 自駕最終日 🚗</h4>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>09:30</strong> | 自駕： 退房，開車北上 (車程約 2 - 2.5 小時)。</li>
                            <li><strong>11:30</strong> | 購物： <a href="https://maps.google.com/maps?q=Mitsui+Outlet+Park+Sapporo+Kitahiroshima" target="_blank" rel="noopener noreferrer" class="map-link">三井 Outlet Park 札幌北廣島<span class="map-icon">📍</span></a> (含午餐)。</li>
                            <li><strong>15:30</strong> | 自駕： 返回札幌市區 (車程約 30-40 分鐘)，辦理車輛歸還 (歸還前應加滿油料)。</li>
                            <li><strong>16:30</strong> | 入住： <a href="https://maps.google.com/maps?q=Hotel+Gracery+Sapporo" target="_blank" rel="noopener noreferrer" class="map-link">格拉斯麗札幌飯店<span class="map-icon">📍</span></a>。</li>
                            <li><strong>17:00</strong> | 重點行程： <a href="https://maps.google.com/maps?q=Sapporo+Snow+Festival+Odori+Site" target="_blank" rel="noopener noreferrer" class="map-link">札幌雪祭<span class="map-icon">📍</span></a> (大通會場 / 薄野會場)。</li>
                            <li><strong>20:00</strong> | 晚餐： 湯咖哩 或 成吉思汗烤肉。
                                <button class="ai-recommend-btn" data-location="札幌 靠近札幌雪祭會場" data-id="rec-5">✨ 推薦餐廳</button>
                                <div id="rec-5-result" class="ai-recommendation" style="display: none;"></div>
                            </li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>當日注意事項：</strong> 2/3 晚間可能為雪祭試營運，人潮較少。大通會場看雪雕，薄野會場看冰雕。夜間戶外極冷，備妥暖暖包及行動電源。
                        </div>
                    </div>

                    <!-- Day 6 Card -->
                    <div class="border rounded-lg shadow-md bg-white p-5">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Day 6: 2/4 (二) — 機場設施巡禮與啟程</h3>
                        <ul class="space-y-3 list-disc list-inside text-gray-700">
                            <li><strong>08:30</strong> | 退房，交通： 搭乘 JR 快速 Airport 號 (約 45-50 分鐘) 前往 <a href="https://maps.google.com/maps?q=New+Chitose+Airport" target="_blank" rel="noopener noreferrer" class="map-link">新千歲機場<span class="map-icon">📍</span></a>。</li>
                            <li><strong>10:30</strong> | 景點： 新千歲機場 (CTS)。</li>
                            <li><strong>11:00</strong> | 重點行程： Royce' 巧克力世界、<a href="https://maps.google.com/maps?q=Doraemon+Waku+Waku+Sky+Park" target="_blank" rel="noopener noreferrer" class="map-link">哆啦A夢空中樂園<span class="map-icon">📍</span></a> (10:00 開放)。</li>
                            <li><strong>13:00</strong> | 機場午餐 (例如：北海道拉麵道場) 及 採購伴手禮。</li>
                            <li><strong>14:40</strong> | 🛫 啟程返台。</li>
                        </ul>
                        <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                            <strong>當日注意事項：</strong> 新千歲機場設施豐富，建議至少提早 3.5 小時抵達，以預留充足時間體驗及辦理登機手續。
                        </div>
                    </div>

                </div>
            </section>

            <!-- 3. 雪地安全 (Safety) -->
            <section id="content-safety" class="content-section">
                <h2 class="text-2xl font-bold text-red-700 mb-4">冬季駕駛安全規範</h2>
                <p class="text-gray-700 mb-4">本行程包含三日雪地自駕，此為體驗北海道冬季景觀之有效方式，然須以安全為最高前提。</p>
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg border">
                        <h3 class="text-lg font-semibold text-gray-800">車輛規格</h3>
                        <p class="text-gray-700">必須租用 <span class="font-bold text-red-600">4WD (四輪驅動)</span> 並配備 <span class="font-bold text-red-600">雪胎 (Studless Tire)</span> 之車款。</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg border">
                        <h3 class="text-lg font-semibold text-gray-800">行車速度與車距</h3>
                        <p class="text-gray-700">建議最高時速應控制於 <span class="font-bold">50-60 公里/小時</span>。安全車距應維持為平時的 2-3 倍。</p>
                    </div>
                    <div class="p-4 bg-yellow-100 border border-yellow-300 rounded-lg">
                        <h3 class="text-lg font-semibold text-yellow-800">潛在危險： 黑冰 (Black Ice)</h3>
                        <p class="text-yellow-700">路面看似濕滑，實為薄冰，是主要風險來源。行經<span class="font-bold">橋樑、隧道口、背陰處</span>時應特別注意，避免在這些路段急煞車或急轉向。</p>
                    </div>
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800">時間管理</h3>
                        <p class="text-blue-700">北海道冬季約於 <span class="font-bold">16:00</span> 天色開始昏暗。應規劃於日落前抵達當日住宿點，<span class="font-bold">避免夜間駕駛</span>。</p>
                    </div>
                </div>
            </section>

            <!-- 4. 裝備清單 (Gear) -->
            <section id="content-gear" class="content-section">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">冬季關鍵裝備清單</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 衣物 -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">衣物 (洋蔥式穿搭)</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li><span class="font-semibold text-blue-700">[外層]</span> 防水防風外套 (滑雪外套為佳)</li>
                            <li><span class="font-semibold text-blue-700">[中層]</span> 刷毛 (Fleece) 或輕羽絨</li>
                            <li><span class="font-semibold text-blue-700">[底層]</span> 保暖排汗底層衣褲</li>
                        </ul>
                    </div>
                    <!-- 足部與配件 -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">足部與配件</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li class="font-bold text-red-600">防水防滑高筒雪靴 (關鍵裝W備)</li>
                            <li>毛帽 (可遮耳)</li>
                            <li>防水手套</li>
                            <li>圍巾 (或脖圍)</li>
                        </ul>
                    </div>
                    <!-- 兒童專區 -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">兒童專區</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li>連身雪衣或雪褲 (適用於雪地活動)</li>
                            <li>備用手套 (易濕)</li>
                            <li>太陽眼鏡 (防止雪地反光)</li>
                        </ul>
                    </div>
                    <!-- 其他 -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">其他</h3>
                        <ul class="space-y-2 list-disc list-inside text-gray-700">
                            <li>行動電源 (低溫易耗電)</li>
                            <li>暖暖包</li>
                            <li><span class="font-semibold text-green-700">[自駕]</span> 台灣駕照正本、日文譯本、護照</li>
                            <li>保濕乳液 / 護唇膏</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 5. 彈性建議 (Options) -->
            <section id="content-options" class="content-section">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">彈性行程建議</h2>
                <div class="space-y-4">
                    <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                        <h3 class="text-lg font-semibold text-green-800">親子雪地活動</h3>
                        <p class="text-green-700">目前行程以觀賞雪景為主。建議於 Day 3 (支笏湖) 或 Day 4 (洞爺湖) 畔，尋找安全的積雪區域，保留 30-60 分鐘進行堆雪人等親子活動，可攜帶簡易玩沙工具。</p>
                    </div>
                    <div class="p-4 bg-pink-50 rounded-lg border border-pink-200">
                        <h3 class="text-lg font-semibold text-pink-800">札幌市區甜點體驗</h3>
                        <p class="text-pink-700">於 Day 2 或 Day 5 在札幌市區時，可考慮安排品嚐在地知名甜點（例如：KINOTOYA BAKE 起司塔、椿サロン 舒芙蕾鬆餅），增加行程豐富性。</p>
                    </div>
                    <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
                        <h3 class="text-lg font-semibold text-orange-800">增設中途休息點</h3>
                        <p class="text-orange-700">在長途自駕日，可利用「道の駅」(公路休息站) 進行短暫休息，讓兒童下車活動，並品嚐當地小吃，以緩解乘車疲勞。</p>
</div>
                </div>
            </section>
        </main>
        
        <!-- 頁尾 -->
        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>此報告由 AI 協同產生，僅供規劃參考。所有時間、店家資訊及活動內容應以實際情況為準。</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 導覽列分頁切換 ---
            const tabs = document.querySelectorAll('.nav-tab');
            const sections = document.querySelectorAll('.content-section');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有標籤的 active 狀態
                    tabs.forEach(t => t.classList.remove('active'));
                    // 隱藏所有內容區塊
                    sections.forEach(s => s.classList.remove('active'));

                    // 為點擊的標籤加上 active 狀態
                    tab.classList.add('active');
                    // 顯示對應的內容區塊
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`content-${tabId}`).classList.add('active');
                });
            });

            // --- Gemini API 金鑰 (請留空，由 Canvas 提供) ---
            const apiKey = "";
            const genaiModel = "gemini-2.5-flash-preview-09-2025";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${genaiModel}:generateContent?key=${apiKey}`;

            // --- 指數退避重試函式 ---
            async function fetchWithExponentialBackoff(url, payload, retries = 5, delay = 1000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            if (response.status === 429 || response.status >= 500) {
                                // 觸發重試
                                throw new Error(`Retryable error: ${response.status}`);
                            } else {
                                // 不可重試的錯誤
                                const errorResult = await response.json().catch(() => ({}));
                                const errorText = errorResult.error?.message || `HTTP error! status: ${response.status}`;
                                return { error: `API 請求失敗: ${errorText}` };
                            }
                        }
                        
                        const result = await response.json();
                        return { data: result };

                    } catch (error) {
                        if (i === retries - 1) {
                            // 最後一次重試失敗
                            return { error: `API 請求失敗，已達重試上限: ${error.message}` };
                        }
                        // 等待後重試
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // 指數增加延遲
                    }
                }
                return { error: "API 請求失敗，已達重試上限。" };
            }

            // --- 處理 AI 推薦 ---
            async function getRestaurantRecommendation(location, button, resultDiv) {
                if (!apiKey && apiKey.length === 0) {
                    console.error("Gemini API 金鑰未設定。");
                    resultDiv.innerHTML = "抱歉，AI 推薦功能目前無法使用 (API 金鑰未設定)。";
                    resultDiv.style.display = 'block';
                    button.classList.remove('loading');
                    button.disabled = false;
                    return;
                }
                
                button.classList.add('loading');
                button.disabled = true;
                resultDiv.innerHTML = "✨ AI 搜尋中，請稍候...";
                resultDiv.style.display = 'block';

                const userQuery = `
                    尋找 1-2 家在「${location}」附近，適合家庭 (有 7, 5, 3 歲小孩) 的餐廳。
                    請提供餐廳名稱和一句話的簡短理由。
                    使用 Google 搜尋工具。
                `;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: "你是一位友善的北海道旅行助理。請用繁體中文回覆。回覆應簡潔、具體，並專注於使用者的要求。" }]
                    },
                };

                const { data, error } = await fetchWithExponentialBackoff(apiUrl, payload);

                button.classList.remove('loading');
                button.disabled = false;

                if (error) {
                    console.error('Gemini API 呼叫失敗:', error);
                    resultDiv.innerHTML = `抱歉，推薦時發生錯誤。<br>(${error})`;
                    return;
                }

                try {
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) {
                        // 將 AI 回覆中的換行符號轉為 HTML <br>
                        resultDiv.innerHTML = text.replace(/\n/g, '<br>');
                    } else {
                        resultDiv.innerHTML = "抱歉，AI 沒有回傳有效的推薦。";
                    }
                } catch (e) {
                    console.error('解析 AI 回覆失敗:', e);
                    resultDiv.innerHTML = "抱歉，解析 AI 回覆時發生錯誤。";
                }
            }

            // --- 幫所有推薦按鈕加上監聽器 ---
            document.querySelectorAll('.ai-recommend-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const location = button.dataset.location;
                    const resultDivId = button.dataset.id + '-result';
                    const resultDiv = document.getElementById(resultDivId);
                    
                    // 如果已經有內容，再次點擊就隱藏/顯示
                    if (resultDiv.innerHTML !== "" && !button.disabled) {
                        resultDiv.style.display = (resultDiv.style.display === 'none') ? 'block' : 'none';
                    } else if (!button.disabled) {
                        getRestaurantRecommendation(location, button, resultDiv);
                    }
                });
            });

        });
    </script>
</body>
</html>
