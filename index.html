<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2026 北海道冬之親子大縱走</title>
  <meta name="description" content="北海道親子冬季自駕行程：每日重點、行前清單、快速查閱。" />
  <meta name="theme-color" content="#0369a1" />

  <!-- Preconnect for faster CDN loading -->
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 (production UMD) -->
  <script defer src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script defer src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

  <!-- Babel (kept for single-file JSX; if you later want fastest loading, migrate to Vite build) -->
  <script defer src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide Icons -->
  <script defer src="https://unpkg.com/lucide@latest"></script>

  <style>
    /* Better tap targets */
    input[type="checkbox"] { width: 18px; height: 18px; }
    /* Reduce layout shift for icon placeholders */
    i[data-lucide] { display: inline-block; vertical-align: -0.15em; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <noscript>
    <div class="max-w-3xl mx-auto p-4">
      <div class="rounded-xl border border-slate-200 bg-white p-4">
        這個頁面需要啟用 JavaScript 才能正常顯示。
      </div>
    </div>
  </noscript>

  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    // --- Utilities ---
    const STORAGE_KEY = 'hokkaido-checklist-v1';

    function safeParse(json, fallback) {
      try {
        const v = JSON.parse(json);
        return v && typeof v === 'object' ? v : fallback;
      } catch (_) {
        return fallback;
      }
    }

    function saveChecklist(value) {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(value)); } catch (_) {}
    }

    function loadChecklist(fallback) {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        return saved ? safeParse(saved, fallback) : fallback;
      } catch (_) {
        return fallback;
      }
    }

    function downloadJson(filename, data) {
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Lucide Icon wrapper (single-file friendly)
    function Icon({ name, className = 'w-4 h-4' }) {
      return <i data-lucide={name} className={className} aria-hidden="true"></i>;
    }

    const DEFAULT_CHECKLIST = {
      docs: [
        { id: 1, text: '護照 (有效期6個月以上)', checked: false },
        { id: 2, text: '駕照正本 + 日文譯本', checked: false },
        { id: 3, text: 'VJW 入境與海關 QR Code', checked: false },
        { id: 4, text: '電子機票 (TR892 / CI131)', checked: false },
        { id: 5, text: '飯店訂房憑證 (尤其是 Day 5 寄行李用)', checked: false },
      ],
      gear: [
        { id: 6, text: '雪靴 (防水防滑)', checked: false },
        { id: 7, text: '防水手套 (玩雪必備)', checked: false },
        { id: 8, text: '泳衣 (森之空庭用)', checked: false },
        { id: 9, text: '墨鏡 (防雪盲)', checked: false },
        { id: 10, text: '保濕乳液/護唇膏', checked: false },
      ]
    };

    // You can expand these later; kept concise for fast scan on mobile.
    const ITINERARY = [
      {
        day: 'Day 1',
        date: '1/30',
        title: '初抵北國 & 湯咖哩',
        weather: '-1 / -8°C',
        items: [
          { time: '17:20', text: '抵達新千歲機場', icon: 'plane' },
          { time: '18:30', text: 'JR 前往札幌', icon: 'train' },
          { time: '21:00', text: 'Suage+ 湯咖哩', icon: 'utensils', highlight: true },
        ]
      },
      {
        day: 'Day 2',
        date: '1/31',
        title: '神宮 & 燒肉',
        weather: '-2 / -9°C',
        items: [
          { time: '09:00', text: '北海道神宮', icon: 'map-pin' },
          { time: '10:55', text: '炸豬排 Ichimatsu 排隊', icon: 'clock', highlight: true },
          { time: '17:30', text: '燒肉圓山 JIN', icon: 'utensils', highlight: true },
        ]
      },
      {
        day: 'Day 3',
        date: '2/1',
        title: '自駕 & 玩雪',
        weather: '-3 / -12°C',
        items: [
          { time: '10:00', text: '寄放大行李', icon: 'shopping-bag', highlight: true },
          { time: '11:20', text: '瀧野鈴蘭公園 玩雪', icon: 'snowflake' },
          { time: '18:30', text: '入住森之空庭', icon: 'hotel' },
        ]
      },
      {
        day: 'Day 4',
        date: '2/2',
        title: '企鵝 & 洞爺湖',
        weather: '-2 / -10°C',
        items: [
          { time: '10:30', text: '尼克斯海洋公園', icon: 'star' },
          { time: '14:00', text: '昭和新山 熊牧場', icon: 'paw-print' },
          { time: '18:30', text: '洞爺湖飯店入住', icon: 'hotel' },
        ]
      },
      {
        day: 'Day 5',
        date: '2/3',
        title: 'F Village & 購物',
        weather: '-1 / -8°C',
        items: [
          { time: '11:40', text: 'F Village (ES CON FIELD)', icon: 'star', highlight: true },
          { time: '14:30', text: '三井 Outlet', icon: 'shopping-bag' },
          { time: '18:30', text: '雪祭前夜', icon: 'snowflake' },
        ]
      },
      {
        day: 'Day 6',
        date: '2/4',
        title: '返家',
        weather: '0 / -6°C',
        items: [
          { time: '09:00', text: '海鮮丼早餐', icon: 'utensils', highlight: true },
          { time: '11:00', text: '機場午餐', icon: 'utensils' },
          { time: '14:40', text: '起飛返台', icon: 'plane' },
        ]
      },
    ];

    function HokkaidoTripApp() {
      const tabsRef = useRef(null);
      const [activeTab, setActiveTab] = useState(0);
      const [toast, setToast] = useState('');
      const [checklist, setChecklist] = useState(() => loadChecklist(DEFAULT_CHECKLIST));

      // Persist
      useEffect(() => saveChecklist(checklist), [checklist]);

      // Render lucide icons after each paint
      useEffect(() => {
        if (window.lucide && window.lucide.createIcons) {
          window.lucide.createIcons();
        }
      });

      // Keep active tab button visible
      useEffect(() => {
        const el = tabsRef.current;
        if (!el) return;
        const btn = el.querySelector(`[data-tab="${activeTab}"]`);
        if (btn && btn.scrollIntoView) btn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
      }, [activeTab]);

      const stats = useMemo(() => {
        const all = [...checklist.docs, ...checklist.gear];
        const done = all.filter(x => x.checked).length;
        return { done, total: all.length };
      }, [checklist]);

      const toggleCheck = (category, id) => {
        setChecklist(prev => ({
          ...prev,
          [category]: prev[category].map(item => item.id === id ? { ...item, checked: !item.checked } : item)
        }));
      };

      const setAll = (checked) => {
        setChecklist(prev => ({
          docs: prev.docs.map(i => ({ ...i, checked })),
          gear: prev.gear.map(i => ({ ...i, checked })),
        }));
        setToast(checked ? '已全勾選' : '已全清除');
        window.setTimeout(() => setToast(''), 1600);
      };

      const exportChecklist = () => {
        downloadJson('hokkaido-checklist.json', checklist);
        setToast('已匯出 JSON');
        window.setTimeout(() => setToast(''), 1600);
      };

      const importChecklist = async (file) => {
        if (!file) return;
        try {
          const text = await file.text();
          const parsed = safeParse(text, null);
          if (!parsed || !parsed.docs || !parsed.gear) throw new Error('Bad format');
          setChecklist(parsed);
          setToast('已匯入 JSON');
        } catch (_) {
          setToast('匯入失敗：格式不正確');
        }
        window.setTimeout(() => setToast(''), 1800);
      };

      const day = ITINERARY[activeTab];

      return (
        <div className="min-h-screen pb-20">
          <header className="bg-gradient-to-r from-sky-600 to-blue-800 text-white sticky top-0 z-50 shadow">
            <div className="max-w-3xl mx-auto p-5">
              <div className="flex items-start justify-between gap-3">
                <div>
                  <h1 className="text-2xl font-bold tracking-tight">2026 北海道冬之親子大縱走</h1>
                  <div className="mt-1 text-sky-100 text-sm flex flex-wrap gap-x-4 gap-y-1">
                    <span className="inline-flex items-center gap-1"><Icon name="calendar" className="w-4 h-4" />1/30 – 2/4</span>
                    <span className="inline-flex items-center gap-1"><Icon name="car" className="w-4 h-4" />自駕親子行</span>
                    <span className="inline-flex items-center gap-1"><Icon name="check-square" className="w-4 h-4" />清單 {stats.done}/{stats.total}</span>
                  </div>
                </div>
                <div className="hidden sm:flex items-center gap-2">
                  <a className="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/15 text-sm font-semibold" href="#checklist">行前清單</a>
                  <a className="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/15 text-sm font-semibold" href="#itinerary">每日行程</a>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-3xl mx-auto p-4 space-y-6">
            {/* Itinerary */}
            <section id="itinerary" className="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
              <div className="flex items-center justify-between gap-3">
                <h2 className="text-lg font-bold">每日行程</h2>
                <div className="text-sm text-slate-500 inline-flex items-center gap-2">
                  <Icon name="snowflake" className="w-4 h-4 text-sky-500" />
                  <span>{day.weather}</span>
                </div>
              </div>

              <div ref={tabsRef} className="mt-3 flex gap-2 overflow-x-auto pb-2 -mx-1 px-1">
                {ITINERARY.map((d, i) => (
                  <button
                    key={i}
                    data-tab={i}
                    onClick={() => setActiveTab(i)}
                    className={`shrink-0 px-4 py-2 rounded-xl text-sm font-semibold transition ${
                      activeTab === i
                        ? 'bg-sky-600 text-white shadow'
                        : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
                    }`}
                    aria-current={activeTab === i ? 'page' : undefined}
                  >
                    <div className="text-xs opacity-80">{d.date}</div>
                    <div>{d.day}</div>
                  </button>
                ))}
              </div>

              <div className="mt-3">
                <h3 className="text-xl font-bold tracking-tight">{day.title}</h3>

                <div className="mt-3 space-y-3">
                  {day.items.map((it, idx) => (
                    <div key={idx} className={`flex items-start gap-3 rounded-xl p-3 ${it.highlight ? 'bg-orange-50 border border-orange-100' : 'bg-slate-50'}`}>
                      <div className="w-14 shrink-0 font-mono text-sm font-bold text-slate-500">{it.time}</div>
                      <div className="flex-1 flex items-start gap-2">
                        <span className={`${it.highlight ? 'text-orange-600' : 'text-slate-500'} mt-0.5`}>
                          <Icon name={it.icon} className="w-4 h-4" />
                        </span>
                        <div className="text-slate-800">
                          <div className={`${it.highlight ? 'font-bold' : 'font-medium'}`}>{it.text}</div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </section>

            {/* Checklist */}
            <section id="checklist" className="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
              <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                <div>
                  <h2 className="text-lg font-bold">行前檢查清單</h2>
                  <div className="mt-1 text-sm text-slate-500">會自動記住勾選狀態（同一台裝置/瀏覽器）</div>
                </div>

                <div className="flex flex-wrap gap-2">
                  <button onClick={() => setAll(true)} className="px-3 py-2 rounded-xl bg-slate-900 text-white text-sm font-semibold hover:bg-slate-800">全勾</button>
                  <button onClick={() => setAll(false)} className="px-3 py-2 rounded-xl bg-slate-100 text-slate-800 text-sm font-semibold hover:bg-slate-200">全清</button>
                  <button onClick={exportChecklist} className="px-3 py-2 rounded-xl bg-slate-100 text-slate-800 text-sm font-semibold hover:bg-slate-200">匯出</button>
                  <label className="px-3 py-2 rounded-xl bg-slate-100 text-slate-800 text-sm font-semibold hover:bg-slate-200 cursor-pointer">
                    匯入
                    <input type="file" accept="application/json" className="hidden" onChange={(e) => importChecklist(e.target.files?.[0])} />
                  </label>
                </div>
              </div>

              <div className="mt-4">
                <div className="h-2 w-full bg-slate-100 rounded-full overflow-hidden" aria-hidden="true">
                  <div className="h-full bg-emerald-500" style={{ width: `${Math.round((stats.done / Math.max(stats.total, 1)) * 100)}%` }} />
                </div>
                <div className="mt-2 text-sm text-slate-500">完成度：{stats.done}/{stats.total}</div>
              </div>

              <div className="mt-4 grid grid-cols-1 gap-5">
                <ChecklistGroup
                  title="重要文件"
                  items={checklist.docs}
                  onToggle={(id) => toggleCheck('docs', id)}
                />
                <ChecklistGroup
                  title="衣物與裝備"
                  items={checklist.gear}
                  onToggle={(id) => toggleCheck('gear', id)}
                />
              </div>
            </section>

            {/* Footer */}
            <footer className="text-center text-xs text-slate-400 py-4">
              單檔版本（GitHub Pages 友善）・如果你想要更快載入，我可以再幫你改成 Vite build 版本。
            </footer>
          </main>

          {/* Toast */}
          {toast && (
            <div className="fixed bottom-4 left-1/2 -translate-x-1/2 z-50">
              <div className="rounded-full bg-slate-900 text-white px-4 py-2 text-sm shadow-lg">
                {toast}
              </div>
            </div>
          )}
        </div>
      );
    }

    function ChecklistGroup({ title, items, onToggle }) {
      const done = items.filter(x => x.checked).length;
      return (
        <div className="rounded-2xl border border-slate-100 bg-slate-50 p-4">
          <div className="flex items-center justify-between">
            <h3 className="text-sm font-bold text-slate-700">{title}</h3>
            <div className="text-xs text-slate-500">{done}/{items.length}</div>
          </div>
          <div className="mt-3 space-y-2">
            {items.map((item) => (
              <label key={item.id} className="flex items-start gap-3 p-2 rounded-xl hover:bg-white cursor-pointer">
                <input
                  type="checkbox"
                  checked={!!item.checked}
                  onChange={() => onToggle(item.id)}
                  className="mt-0.5"
                />
                <span className={item.checked ? 'text-slate-400 line-through decoration-slate-400' : 'text-slate-800'}>
                  {item.text}
                </span>
              </label>
            ))}
          </div>
        </div>
      );
    }

    // Mount
    ReactDOM.createRoot(document.getElementById('root')).render(<HokkaidoTripApp />);
  </script>
</body>
</html>
