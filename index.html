<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2026 北海道冬季旅行｜互動行程規劃</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg: #ffffff;
  --fg: #1b1f23;
  --muted:#6b7280;
  --card:#f7f7f8;
  --accent:#0ea5e9;
  --border:#e5e7eb;
  --ok:#16a34a;
  --warn:#b45309;
}
:root[data-theme="dark"]{
  --bg:#0b0f14;
  --fg:#e5e7eb;
  --muted:#9aa3af;
  --card:#0f141b;
  --accent:#38bdf8;
  --border:#1f2937;
  --ok:#22c55e;
  --warn:#f59e0b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--fg);
  font-family: "Noto Serif JP", ui-serif, "Noto Serif CJK JP", "Hiragino Mincho ProN", "Source Han Serif TC", serif;
  line-height:1.5;
}
.container{max-width:1100px;margin:0 auto;padding:20px}
header{
  position:sticky; top:0; backdrop-filter:saturate(180%) blur(8px);
  background:color-mix(in oklab, var(--bg) 85%, transparent);
  z-index:10; border-bottom:1px solid var(--border);
}
.header-inner{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:12px 0}
h1{font-size:20px; margin:0; font-weight:700; letter-spacing:0.02em}
.toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
input[type="search"], select, button{
  border:1px solid var(--border); background:var(--bg); color:var(--fg);
  padding:8px 10px; border-radius:10px; font-size:14px;
}
button{cursor:pointer}
button.primary{background:var(--accent); color:#00263a; border-color:color-mix(in oklab, var(--accent) 70%, black)}
button.ghost{background:transparent}
.badge{font-size:12px; color:var(--muted)}
main{padding:16px 0 40px}

.card{
  background:var(--card); border:1px solid var(--border); border-radius:16px; margin:14px 0; overflow:hidden;
}
.card header{
  position:relative; top:auto; background:transparent; border:0;
}
.card-head{
  display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center;
  padding:14px 16px;
}
.card-title{margin:0; font-size:18px; font-weight:700}
.card-sub{margin:2px 0 0;font-size:13px;color:var(--muted)}
.card-actions{display:flex; gap:8px}
.card-body{padding:0 0 10px 0}
.timeline{border-top:1px solid var(--border)}
.row{
  display:grid; grid-template-columns:92px 1fr 120px; gap:8px; align-items:start; padding:10px 16px;
  border-bottom:1px solid var(--border);
}
.row:last-child{border-bottom:0}
.time{font-variant-numeric: tabular-nums; font-weight:600}
.item{display:flex; gap:10px; align-items:flex-start}
.item input[type="checkbox"]{margin-top:4px; width:16px; height:16px; accent-color:var(--ok)}
.item .text{flex:1; border-radius:8px; padding:2px 4px}
.item .text[contenteditable="true"]{outline:2px dashed var(--accent); background:color-mix(in oklab, var(--card) 70%, transparent)}
.note{
  font-size:12px; color:var(--muted);
  display:flex; gap:6px; align-items:center; margin-top:4px;
}
.note textarea{
  width:100%; resize:vertical; min-height:28px; max-height:140px;
  background:var(--bg); color:var(--fg); border:1px dashed var(--border); border-radius:8px; padding:6px 8px;
}
.kv{font-size:13px; color:var(--muted)}
.kv b{color:var(--fg)}
.controls{display:flex; gap:8px; flex-wrap:wrap; margin:10px 0}
.small{font-size:12px;color:var(--muted)}
hr.sep{border:none; border-top:1px dashed var(--border); margin:14px 0}

footer{margin-top:28px; color:var(--muted); font-size:12px}
.hidden{display:none}

@media (max-width:760px){
  .row{grid-template-columns:78px 1fr}
  .row .note-col{grid-column:1 / -1}
}
@media print{
  header, .controls, .card-actions, .toolbar{display:none!important}
  .card{break-inside:avoid}
  body{background:#fff; color:#000}
}
</style>
</head>
<body>
<header>
  <div class="container header-inner">
    <div>
      <h1>2026 北海道冬季旅行｜互動行程規劃</h1>
      <div class="badge">札幌雪祭・溫泉・道南親子六日｜兩家庭共 7 人（2 大＋2 小＋2 大＋1 小）</div>
    </div>
    <div class="toolbar">
      <input id="q" type="search" placeholder="搜尋：關鍵字或時間（例：洞爺湖、動物園、09:30）" />
      <select id="area">
        <option value="">全部地區</option>
        <option>札幌</option>
        <option>支笏湖</option>
        <option>洞爺湖</option>
        <option>登別</option>
        <option>北廣島</option>
        <option>機場</option>
      </select>
      <button id="toggleTheme" class="ghost" title="主題切換">主題切換</button>
      <button id="expandAll" class="ghost" title="展開/收合">展開/收合</button>
      <button id="exportJson" class="ghost" title="匯出JSON">匯出JSON</button>
      <button id="print" class="primary" title="列印/存成PDF">列印</button>
    </div>
  </div>
</header>

<main class="container" id="app"></main>

<footer class="container">
  <hr class="sep" />
  <div>字體：Noto Serif JP（若無則改用系統襯線）。資料會自動儲存於本機瀏覽器，不會上傳。</div>
</footer>

<script>
/* ===== 行程資料（可直接修改） ===== */
const ITINERARY = [
  {
    id:"2026-01-30",
    date:"1/30（四）",
    title:"札幌",
    stay:"Hotel Trinity Sapporo",
    meta:"機場→札幌→入住→狸小路",
    area:"札幌",
    items:[
      {t:"17:20", txt:"抵達 新千歲機場", area:"機場"},
      {t:"18:00", txt:"JR 快速 Airport 號 → 札幌站（45–50 分）", area:"札幌"},
      {t:"18:50", txt:"地鐵南北線至大通站 → 步行 5 分", area:"札幌"},
      {t:"19:15", txt:"入住 飯店（Hotel Trinity Sapporo）", area:"札幌"},
      {t:"19:45", txt:"晚餐：狸小路／薄野", area:"札幌"},
      {t:"21:00", txt:"狸小路商店街（唐吉訶德 24h）", area:"札幌"},
    ]
  },
  {
    id:"2026-01-31",
    date:"1/31（五）",
    title:"札幌市區",
    stay:"Hotel Trinity Sapporo",
    meta:"圓山公園・北海道神宮・圓山動物園・購物",
    area:"札幌",
    items:[
      {t:"09:30", txt:"地鐵東西線 → 圓山公園／北海道神宮（神宮全天）", area:"札幌"},
      {t:"11:30", txt:"圓山動物園（冬季 16:00 閉園）", area:"札幌"},
      {t:"15:00", txt:"市區購物：PARCO／地下街（室內動線避寒）", area:"札幌"},
      {t:"18:00", txt:"晚餐：湯咖哩／成吉思汗", area:"札幌"},
      {t:"20:00", txt:"大通公園散步（雪祭準備期）", area:"札幌"},
    ]
  },
  {
    id:"2026-02-01",
    date:"2/1（六）",
    title:"札幌→洞爺湖（雪地活動）",
    stay:"The Lake View Toya Nonokaze Resort",
    meta:"瀧野鈴蘭・支笏湖冰濤節・洞爺湖",
    area:"洞爺湖",
    items:[
      {t:"08:30", txt:"取車，自駕出發（租車手續 30–45 分）", area:"札幌"},
      {t:"09:15", txt:"抵達 瀧野鈴蘭公園", area:"札幌"},
      {t:"09:30–11:30", txt:"雪胎滑道體驗（約 2 小時）", area:"札幌"},
      {t:"11:45", txt:"前往 支笏湖（車程 45–60 分）", area:"支笏湖"},
      {t:"12:45–14:15", txt:"支笏湖午餐＋冰濤節", area:"支笏湖"},
      {t:"14:30", txt:"前往 洞爺湖（車程 1.5–2 小時）", area:"洞爺湖"},
      {t:"16:10", txt:"入住 乃之風度假村（建議日落前抵達）", area:"洞爺湖"},
      {t:"17:00", txt:"溫泉（禁止泳衣）", area:"洞爺湖"},
      {t:"18:00", txt:"飯店會席晚餐", area:"洞爺湖"},
    ]
  },
  {
    id:"2026-02-02",
    date:"2/2（日）",
    title:"洞爺湖→登別→洞爺湖",
    stay:"stays 可可飯店",
    meta:"尼克斯・熊牧場・有珠山纜車",
    area:"洞爺湖",
    items:[
      {t:"09:30", txt:"自駕前往 登別尼克斯海洋公園（50–60 分）", area:"登別"},
      {t:"10:30", txt:"國王企鵝遊行（建議提前 20 分卡位）", area:"登別"},
      {t:"12:00", txt:"登別午餐", area:"登別"},
      {t:"13:30", txt:"返回洞爺湖 → 昭和新山熊牧場（約 50 分）", area:"洞爺湖"},
      {t:"15:00", txt:"有珠山纜車（冬季末班 16:00；遇強風停駛）", area:"洞爺湖"},
      {t:"17:30", txt:"入住 stays／可可飯店（洞爺湖）", area:"洞爺湖"},
    ]
  },
  {
    id:"2026-02-03",
    date:"2/3（一）",
    title:"洞爺湖→北廣島→札幌（雪祭）",
    stay:"Hotel Gracery Sapporo",
    meta:"三井 Outlet・札幌雪祭",
    area:"札幌",
    items:[
      {t:"09:30", txt:"退房 北上（2–2.5 小時）", area:"洞爺湖"},
      {t:"11:30", txt:"三井 Outlet 札幌北廣島（含午餐）", area:"北廣島"},
      {t:"15:30", txt:"返札幌 還車（歸還前加滿油）", area:"札幌"},
      {t:"16:30", txt:"入住 飯店（Hotel Gracery Sapporo）", area:"札幌"},
      {t:"17:00", txt:"札幌雪祭：大通會場／薄野會場", area:"札幌"},
      {t:"20:00", txt:"晚餐：湯咖哩／成吉思汗", area:"札幌"},
    ]
  },
  {
    id:"2026-02-04",
    date:"2/4（二）",
    title:"札幌→新千歲→啟程",
    stay:"—",
    meta:"機場設施・返台",
    area:"機場",
    items:[
      {t:"08:30", txt:"退房 → JR 快速 Airport 號至機場（45–50 分）", area:"札幌"},
      {t:"10:30", txt:"新千歲機場設施巡禮（建議預留 ≥3.5 小時）", area:"機場"},
      {t:"11:00", txt:"Royce 巧克力世界／哆啦 A 夢空中樂園（10:00 開放）", area:"機場"},
      {t:"13:00", txt:"機場午餐・伴手禮採購", area:"機場"},
      {t:"14:40", txt:"啟程返台", area:"機場"},
    ]
  },
];

/* ===== 狀態與儲存 ===== */
const KEY = "hokkaido-2026-itinerary-state";
function loadState(){
  try{ return JSON.parse(localStorage.getItem(KEY) || "{}"); }catch{return {}}
}
function saveState(s){ localStorage.setItem(KEY, JSON.stringify(s)); }
let STATE = loadState();

/* ===== UI 建構 ===== */
const app = document.getElementById("app");

function el(tag, attrs={}, ...children){
  const node = document.createElement(tag);
  for(const [k,v] of Object.entries(attrs||{})){
    if(k==="class") node.className = v;
    else if(k==="dataset") Object.assign(node.dataset, v);
    else if(k.startsWith("on")) node.addEventListener(k.slice(2), v);
    else node.setAttribute(k, v);
  }
  for(const c of children){
    if(c==null) continue;
    node.appendChild( typeof c === "string" ? document.createTextNode(c) : c );
  }
  return node;
}

function Card(day){
  const open = STATE.open?.[day.id] ?? true;
  const head = el("div",{class:"card-head"},
    el("div",{},
      el("div",{class:"card-title"}, `Day ${formatDayIndex(day.id)}｜${day.date} ${day.title}`),
      el("div",{class:"card-sub"}, `住宿：${day.stay}　|　路線重點：${day.meta}`)
    ),
    el("div",{class:"card-actions"},
      el("button",{class:"ghost", onclick:()=>toggleOpen(day.id)}, open?"收合":"展開"),
      el("button",{class:"ghost", onclick:()=>addItem(day.id)}, "新增行程"),
      el("button",{class:"ghost", onclick:()=>editMode(day.id,true)}, "編輯"),
      el("button",{class:"ghost", onclick:()=>editMode(day.id,false)}, "完成")
    )
  );

  const rows = day.items.map((it, idx)=>{
    const checked = STATE.done?.[day.id]?.[idx] ?? false;
    const noteTxt = (STATE.notes?.[day.id]?.[idx]) ?? "";
    const editable = STATE.edit?.[day.id] ?? false;

    const checkbox = el("input",{type:"checkbox", checked, onchange:(e)=>{
      STATE.done ??= {}; STATE.done[day.id] ??= {};
      STATE.done[day.id][idx] = e.target.checked; saveState(STATE);
    }});

    const text = el("div",{class:"text", contenteditable: editable?"true":"false"}, it.txt);
    text.addEventListener("input", ()=>{
      // 同步到資料
      it.txt = text.textContent.trim();
      saveState(STATE);
    });

    const delBtn = el("button",{class:"ghost small", onclick:()=>{
      if(!confirm("刪除此行程？")) return;
      day.items.splice(idx,1);
      render();
    }}, "刪除");

    const plusBtn = el("button",{class:"ghost small", onclick:()=>{
      day.items.splice(idx+1,0,{t:"", txt:"（新行程）", area:day.area});
      render();
    }}, "插入");

    const actionBtns = el("div",{class:"small"}, editable ? el("span",{}, plusBtn, " ", delBtn) : el("span",{},""));

    const note = el("div",{class:"note note-col"},
      el("span",{}, "備註"),
      el("textarea",{placeholder:"可輸入餐食、交通、開放時間等", value:noteTxt, oninput:(e)=>{
        STATE.notes ??= {}; STATE.notes[day.id] ??= {};
        STATE.notes[day.id][idx] = e.target.value;
        saveState(STATE);
      }})
    );

    const timeBox = el("div",{class:"time"},
      el("input",{
        type:"text", value:it.t, title:"可輸入時間或區段（例：09:30、09:30–11:00）",
        style:"width:86px;background:transparent;border:1px solid var(--border);border-radius:8px;padding:4px 6px",
        oninput:(e)=>{ it.t = e.target.value; saveState(STATE); }
      })
    );

    const areaTag = el("div",{class:"kv"}, el("span",{}, "地區："), el("b",{}, it.area||day.area));

    return el("div",{class:"row", dataset:{area: (it.area||day.area)}},
      timeBox,
      el("div",{class:"item"}, checkbox, el("div",{style:"flex:1"}, text, areaTag, note)),
      el("div",{}, actionBtns)
    );
  });

  const body = el("div",{class:"card-body" + (open?"":" hidden")},
    el("div",{class:"timeline"}, ...rows)
  );

  const root = el("section",{class:"card", id:day.id}, head, body);
  return root;
}

function render(){
  app.innerHTML = "";
  const q = document.getElementById("q").value.trim();
  const area = document.getElementById("area").value;

  ITINERARY.forEach(day=>{
    // 關鍵字過濾
    const hitDay = [day.date, day.title, day.stay, day.meta].join(" ");
    const hitItems = day.items.filter(it=>{
      const s = [it.t, it.txt, it.area].join(" ");
      const okQ = q ? (s.includes(q) || hitDay.includes(q)) : true;
      const okA = area ? ((it.area||day.area)===area || day.area===area) : true;
      return okQ && okA;
    });
    // 如果因為過濾變空，整卡也要看是否 day 資訊有命中
    if(q || area){
      if(hitItems.length===0) return;
      const clone = JSON.parse(JSON.stringify(day));
      clone.items = hitItems;
      app.appendChild(Card(clone));
    }else{
      app.appendChild(Card(day));
    }
  });
}

/* ===== 輔助功能 ===== */
function formatDayIndex(id){
  // 2026-01-30 -> 1
  const base = new Date("2026-01-30");
  const d = new Date(id);
  const diff = Math.round((d - base) / (1000*60*60*24));
  return diff + 1;
}
function toggleOpen(id){
  STATE.open ??= {};
  STATE.open[id] = !(STATE.open[id] ?? true);
  saveState(STATE); render();
}
function addItem(id){
  const day = ITINERARY.find(d=>d.id===id);
  if(!day) return;
  day.items.push({t:"", txt:"（新行程）", area:day.area});
  STATE.edit ??= {}; STATE.edit[id] = true;
  render();
}
function editMode(id, on){
  STATE.edit ??= {}; STATE.edit[id] = !!on; saveState(STATE); render();
}

/* ===== 工具列事件 ===== */
document.getElementById("q").addEventListener("input", render);
document.getElementById("area").addEventListener("change", render);
document.getElementById("expandAll").addEventListener("click", ()=>{
  const openNow = Object.values(STATE.open??{}).every(v=>v===true);
  // 若目前幾乎都開著，就全部收起；否則全部展開
  STATE.open = {};
  ITINERARY.forEach(d=>STATE.open[d.id] = !openNow);
  saveState(STATE); render();
});
document.getElementById("toggleTheme").addEventListener("click", ()=>{
  const root = document.documentElement;
  const next = root.dataset.theme==="dark" ? "" : "dark";
  if(next) root.dataset.theme = next; else root.removeAttribute("data-theme");
  localStorage.setItem("theme", next);
});
document.getElementById("print").addEventListener("click", ()=>window.print());
document.getElementById("exportJson").addEventListener("click", ()=>{
  const payload = { itinerary: ITINERARY, state: STATE, exportedAt: new Date().toISOString() };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "hokkaido-2026-itinerary.json"; a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 1500);
});

/* ===== 預設主題 ===== */
(function(){
  const saved = localStorage.getItem("theme");
  if(saved){ document.documentElement.dataset.theme = saved; }
})();

/* 初始渲染 */
render();
</script>
</body>
</html>
